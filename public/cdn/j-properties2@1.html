<style>.ui-properties2-container{padding:0 0 20px}.ui-properties2-group:first-child{margin-top:10px}.ui-properties2-group:last-child section{margin-bottom:0}.ui-properties2-group{padding:0;margin-bottom:20px;border:1px solid #E0E0E0;border-radius:var(--radius) var(--radius) 0 0}.ui-properties2-2 .ui-properties2-group{border:0}.ui-properties2-group label{display:block;padding:10px 15px;font-size:16px;font-weight:bold;background-color:#F8F8F8;border-radius:var(--radius) var(--radius) 0 0}.ui-properties2-2 label{background:transparent;font-size:11px;color:#A0A0A0;font-weight:normal;padding-bottom:5px}.ui-properties2-2 section{background:#FFF;border-radius:15px;padding:10px 0;border:1px solid #E0E0E0}.ui-properties2-group label i{width:22px}.ui-properties2-group label i:before{content:'\f146'}.ui-properties2-hidden label i:before{content:'\f0fe' !important}.ui-properties2-hidden section{display:none}.ui-properties2-item{padding:6px 0;background-color:#FFF;font-size:12px;border-top:1px solid #EBEBEB}.ui-properties2-2 .ui-properties2-item{border-top-color:#ECECEC;margin:0 15px}.ui-properties2-2 .ui-properties2-item:last-child div{border-bottom:0}.ui-properties2-item>i{float:left;width:24px;height:24px;margin:10px 5px 0 0;font-size:20px}.ui-properties2-2 .ui-properties2-item>i{margin-top:8px;background:#606060;border-radius:6px;font-size:14px;color:#FFF;text-align:center;line-height:24px;width:24px;height:24px}.ui-properties2-isnote>i{margin-top:17px !important}.ui-properties2-required .ui-properties2-key:after{content:'*';color:red;margin-left:5px;font-weight:bold}.ui-properties2-key{float:left;width:170px;line-height:24px;padding:0 5px 0 15px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:#707070}.ui-properties2-key i{margin-right:7px}.ui-properties2-2 .ui-properties2-item{cursor:pointer}.ui-properties2-2 .ui-properties2-value{margin-left:170px;text-align:right;color:#777;margin-right:0;line-height:21px;font-weight:normal !important;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ui-properties2-2 .ui-properties2-item{font-size:13px;padding:0;border-top:0}.ui-properties2-2 .ui-properties2-item>div{padding:10px 0 8px;border-bottom:1px solid #E0E0E0}.ui-properties2-2 .ui-properties2-isicon>div{margin-left:40px}.ui-properties2-2 .ui-properties2-key{color:#000;padding-left:0;line-height:20px}.ui-properties2-2 .ui-properties2-color span b{width:19px;border-radius:100%}.ui-properties2-value{margin:0 10px 0 170px;line-height:21px}.ui-properties2-note{color:#A0A0A0;font-size:11px;line-height:13px;font-weight:normal}.ui-properties2-string, .ui-properties2-number, .ui-properties2-date, .ui-properties2-list, .ui-properties2-menu, .ui-properties2-file{padding:0}.ui-properties2-string input, .ui-properties2-number input, .ui-properties2-date input{outline:0;height:21px;padding:0;margin:0;width:100%;border:0;line-height:21px;background-color:transparent}.ui-properties2-2 input{text-align:right;color:#777;height:17px}.ui-properties2 input:disabled{color:#A0A0A0}.ui-disabled .ui-properties2-value{color:#A0A0A0;cursor:default}.ui-disabled .ui-properties2-value *{cursor:default}.ui-properties2-date>i{float:right;width:18px;margin:4px 0 0;text-align:right;font-size:12px}.ui-properties2-date>div{margin-right:18px}.ui-properties2-bool, .ui-properties2-list, .ui-properties2-menu, .ui-properties2-color, .ui-properties2-fontawesome, .ui-properties2-emoji, .ui-properties2-file{line-height:22px}.ui-properties2-bool span{width:32px;height:18px;display:inline-block;border:1px solid #E0E0E0;line-height:15px;font-size:9px;margin:3px 0 5px;position:relative;cursor:pointer;color:#FFF;vertical-align:top;border-radius:100px;background:#E0E0E0;transition:all 0.3s;text-align:left}.ui-properties2-2 .ui-properties2-bool span{margin-top:0}.ui-properties2-bool span i{width:16px;height:16px;position:relative;display:inline-block;border-radius:100px;background:#FFF;transition:margin 0.3s}.ui-properties2-bool .checked{background-color:var(--color);border-color:var(--color)}.ui-properties2-bool .checked i{margin-left:14px}.ui-disabled .ui-properties2-bool .checked{background-color:#A0A0A0;border-color:#A0A0A0}.ui-properties2-fontawesometoggle, .ui-properties2-emojitoggle, .ui-properties2-color{width:22px;line-height:22px;display:block;cursor:pointer;font-size:20px;position:relative;text-align:left;margin-bottom:3px;display:inline-block;margin-right:1px}.ui-properties2-2 .ui-properties2-fontawesometoggle, .ui-properties2-2 .ui-properties2-emojitoggle, .ui-properties2-2 .ui-properties2-color{margin-bottom:0}.ui-properties2-fontawesometoggle{height:22px}.ui-properties2-2 .ui-properties2-fontawesometoggle{height:auto}.ui-properties2-list, .ui-properties2-menu, .ui-properties2-exec{cursor:pointer}.ui-properties2-list i, .ui-properties2-menu i, .ui-properties2-exec i{margin-left:7px}.ui-properties2-list i, .ui-properties2-menu i{float:right;width:20px;line-height:23px;text-align:right;font-size:12px}.ui-properties2-list span, .ui-properties2-menu span{display:block;margin-right:25px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-properties2-2 .ui-properties2-list span, .ui-properties2-2 .ui-properties2-menu span{margin-right:0 !important}.ui-properties2-2 .ui-properties2-date>i{margin-top:3px}.ui-properties2-2 .ui-properties2-list span, .ui-properties2-2 .ui-properties2-menu span{margin-right:18px}.ui-properties2-2 .ui-properties2-list i, .ui-properties2-2 .ui-properties2-menu i{width:18px;color:#A0A0A0}.ui-properties2-file{cursor:pointer}.ui-properties2-file i{float:right;width:20px;line-height:22px;text-align:right;font-size:10px}.ui-properties2-file span{display:block;margin-right:25px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-properties2-changed{font-weight:bold}.ui-properties2-changed .ui-properties2-key{color:#000}.ui-properties2-color{padding:0;line-height:12px}.ui-properties2-color span b{height:18px;display:block;border-radius:var(--radius);color:gray;width:60px}.ui-properties2-invalid{font-weight:bold;color:red !important}.ui-properties2-invalid .ui-properties2-key{border-right-color:red !important}.ui-properties2-camouflage input{filter:blur(3px)}.ui-properties2-camouflage input:focus{filter:unset}.ui-properties2-ricon{float:right;width:34px;height:24px;line-height:20px;text-align:center;color:gray;font-weight:normal}.ui-properties2-ricon i{font-size:14px;color:#000;padding:5px 0 0;display:block}.ui-properties2-isricon .ui-properties2-value{margin-right:34px}.ui-properties2-2 .ui-properties2-ricon i{padding:3px 0 0}.ui-properties2-2 .ui-properties2-ricon{line-height:20px}.ui-properties2-value.right input{text-align:right}.ui-properties2-value.center input{text-align:center}#properties2upload{position:absolute;left:-100px;top:-100px;opacity:0}.ui-dark .ui-properties2-group{border-color:#404040}.ui-dark .ui-properties2-item{border-color:#303030;background-color:#202020}.ui-dark .ui-properties2-item>div{border-bottom-color:#404040}.ui-dark .ui-properties2-2 section, .ui-dark .ui-properties2-2 .ui-properties2-item{background-color:#282828}.ui-dark .ui-properties2-2 section{border-color:#252525}.ui-dark .ui-properties2-key{color:#A0A0A0}.ui-dark .ui-properties2-2 .ui-properties2-key{color:#FFF}.ui-dark .ui-properties2-group label{background-color:#282828}.ui-dark .ui-properties2-2 label{background-color:transparent}.ui-dark .ui-properties2-bool span{border-color:#505050;background-color:#505050}.ui-dark .ui-properties2-bool span.checked{border-color:var(--color);background-color:var(--color)}.ui-dark .ui-properties2-changed .ui-properties2-key{color:#FFF}.ui-dark .ui-properties2-note{color:#606060}.ui-dark .ui-properties2-list i, .ui-dark .ui-properties2-menu i, .ui-dark .ui-properties2-date{color:gray}.ui-dark .ui-properties2-ricon{color:#888}.ui-dark .ui-properties2-ricon i{color:#FFF}</style>
<script>COMPONENT('properties2@1','datetimeformat:yyyy-MM-dd HH:mm;dateformat:yyyy-MM-dd;timeformat:HH:mm;modalalign:center;style:1;validation:1;encodenotes:1',function(self,config,cls){var cls2='.'+cls,container,types={},paths={},skip=false,values,funcs,datasource,rendered=false;self.nocompile();self.bindvisible();self.validate=function(value){if(config.validation&&value&&value.length){for(var i=0;i<value.length;i++){if(value[i].invalid)return false}}return true};self.make=function(){self.aclass(cls+(config.style===2?(' '+cls+'-2'):''));var scr=self.find('> script');datasource=scr.length?scr.html().trim():null;scr.remove();if(datasource){datasource=new Function('return '+datasource)();for(var i=0;i<datasource.length;i++)paths[datasource[i].name]=1}var elu=$('#properties2upload');if(!elu.length)$(document.body).append('<inp'+'ut type="file" id="prope'+'rties2upload" /'+'>');self.event('click',cls2+'-ricon',function(){var el=self.findel($(this));var index=+el.attrd('index');var arr=datasource||self.get();var item=index>=0?arr[index]:null;if(item&&item.riconclick){item.element=el;self.EXEC(item.riconclick,item,function(val){types[item.type].set(el,val,item)})}});self.append('<div><div class="{0}-container"></div></div>'.format(cls));container=self.find(cls2+'-container');for(var key in types)types[key].init&&types[key].init()};self.finditem=function(el){var index=+$(el).closest(cls2+'-item').attrd('index');var arr=datasource||self.get();return index>=0?arr[index]:null};self.findel=function(el){return $(el).closest(cls2+'-item')};self.modifyval=function(item){values[item.name]=item.value;var items=datasource||self.get();for(var i=0;i<items.length;i++){var m=items[i];if(m.show){var is=funcs[m.name+'_show'](values);self.find(cls2+'-item[data-index="{0}"]'.format(i)).tclass('hidden',!is)}}skip=true;if(datasource){self.get()[item.name]=item.value;UPD(self.path+'.'+item.name)}else UPD(self.path)};self.register=function(name,init,render){types[name]={};types[name].init=init;types[name].render=render;init(self)};types.string={};types.string.init=function(){self.event('click',cls2+'-tstring',function(){var el=$(this);if(!el.hclass('ui-disabled'))el.find('input').focus()});self.event('change','.pstring',function(){var t=this,item=self.finditem(t);var val=t.value.trim();switch(item.transform){case'uppercase':val=val.toUpperCase();t.value=val;break;case'lowercase':val=val.toLowerCase();t.value=val;break;case'capitalize':var tmp=val.split(' ');for(var i=0;i<tmp.length;i++)tmp[i]=tmp[i].substring(0,1).toUpperCase()+tmp[i].substring(1);t.value=tmp.join(' ');break;case'slug':val=val.slug();break}var isvalid=item.required?!!val:true;if(isvalid){if(typeof(item.validate)==='object'){isvalid=item.validate.test(val)}else{switch(item.validate){case'email':isvalid=val.isEmail();break;case'phone':isvalid=val.isPhone();break;case'url':isvalid=val.isURL();break}}}var el=self.findel(t);if(isvalid){item.value=val;item.changed=item.prev!==val;el.tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item);self.modifyval(item)}self.change(true);item.invalid=!isvalid;el.tclass(cls+'-invalid',item.invalid);t.$processed=true;item.required&&self.validate2()})};types.string.render=function(item,next){next('<div class="{0}-string{5}"><input type="text" maxlength="{1}" placeholder="{2}" value="{3}" class="pstring"{4} /></div>'.format(cls,item.maxlength,item.placeholder||'',Thelpers.encode(item.value),item.disabled?' disabled':'',item.camouflage?(' '+cls+'-camouflage'):''))};types.string.set=function(el,value){el.find('input').val(value==null?'':(value+''))};types.password={};types.password.init=function(){self.event('click',cls2+'-tpassword',function(){var el=$(this);if(!el.hclass('ui-disabled'))el.find('input').focus()});self.event('focus','.ppassword',function(){$(this).attr('type','text')});self.event('blur','.ppassword',function(){$(this).attr('type','password')});self.event('change','.ppassword',function(){var t=this,item=self.finditem(t);var val=t.value.trim();var isvalid=item.required?!!val:true;if(isvalid){if(typeof(item.validate)==='object')isvalid=item.validate.test(val)}var el=self.findel(t);if(isvalid){item.value=val;item.changed=item.prev!==val;el.tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item);self.modifyval(item)}item.invalid=!isvalid;el.tclass(cls+'-invalid',item.invalid);t.$processed=true;self.change(true);item.required&&self.validate2()})};types.password.render=function(item,next){next('<div class="{0}-string"><input type="password" maxlength="{1}" placeholder="{2}" value="{3}" class="ppassword"{4} /></div>'.format(cls,item.maxlength,item.placeholder||'',Thelpers.encode(item.value),item.disabled?' disabled':''))};types.password.set=function(el,value){el.find('input').val(value==null?'':(value+''))};types.number={};types.number.init=function(){self.event('click',cls2+'-tnumber',function(){var el=$(this);if(!el.hclass('ui-disabled'))el.find('input').focus()});self.event('blur change','.pnumber',function(){var t=this;if(t.$processed)return;var item=self.finditem(t);var val=t.value.trim();if(!val&&item.value==null)return;var el=self.findel(t);var isvalid=true;val=val.parseFloat();if(item.min!=null&&val<item.min)isvalid=false;else if(item.max!=null&&val>item.max)isvalid=false;item.invalid=!isvalid;if(isvalid){t.value=val+'';item.value=val;item.changed=item.prev!==val;el.tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item);self.modifyval(item)}el.tclass(cls+'-invalid',item.invalid);t.$processed=true;self.change(true);item.required&&self.validate2()});self.event('keydown','.pnumber',function(e){var t=this;t.$processed=false;if(e.which===38||e.which===40){var num=t.value.parseFloat();var item=self.finditem(t);if(e.which===38)num+=item.inc||1;else if(e.which===40)num-=item.inc||1;t.value=num;e.preventDefault()}})};types.number.render=function(item,next){next('<div class="{0}-number"><input type="text" maxlength="{1}" placeholder="{2}" value="{3}" class="pnumber"{4} /></div>'.format(cls,20,item.placeholder||'',Thelpers.encode((item.value==null?'':item.value)+''),item.disabled?' disabled':''))};types.number.set=function(el,value){el.find('input').val(value==null?'':(value+''))};types.date={};types.date.init=function(){self.event('click',cls2+'-tdate',function(){var el=$(this);if(!el.hclass('ui-disabled'))el.find('input').focus()});self.event('blur change','.pdate',function(e){var t=this;if(e.type==='change')SETTER('!datepicker','hide');if(t.$processed)return;var item=self.finditem(t);var val=t.value.parseDate(config.dateformat);item.value=val;item.changed=!item.prev||item.prev.format(config.dateformat)!==val.format(config.dateformat);self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){t.value=val});self.modifyval(item);self.change(true);item.required&&self.validate2();t.$processed=true});self.event('keydown','.pdate',function(e){var t=this;t.$processed=false;if((e.which===38||e.which===40)&&t.value){var val=t.value.parseDate(config.dateformat);var item=self.finditem(t);val=val.add((e.which===40?'-':'')+(item.inc||'1 day'));t.value=val.format(config.dateformat);e.preventDefault()}});self.event('click','.pdate',function(){var t=this,el=$(t);var opt={},item=self.finditem(t);opt.element=el.closest(cls2+'-date').find('input');opt.value=item.value;opt.callback=function(value){t.$processed=false;t.value=value.format(config.dateformat);el.trigger('change')};SETTER('datepicker','show',opt)})};types.date.render=function(item,next){next('<div class="{0}-date"><i class="fa fa-calendar pdate"></i><div><input type="text" maxlength="{1}" placeholder="{2}" value="{3}" class="pdate" /></div></div>'.format(cls,config.dateformat.length,item.placeholder||'',item.value?item.value.format(config.dateformat):''))};types.date.set=function(el,value){el.find('input').val(value==null?'':(value+''))};types.bool={};types.bool.init=function(){if(config.style===2){self.event('click',cls2+'-tbool',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-booltoggle').trigger('click')})}self.event('click',cls2+'-booltoggle',function(e){e.preventDefault();e.stopPropagation();var t=this,el=$(t);var item=self.finditem(t);if(item.disabled)return;el.tclass('checked');item.value=el.hclass('checked');item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item);self.modifyval(item);self.change(true);item.required&&self.validate2()})};types.bool.render=function(item,next){next('<div class="{0}-bool"><span class="{0}-booltoggle{1}"><i></i></span></div>'.format(cls,item.value?' checked':''))};types.bool.set=function(el,value){el.find(cls2+'-booltoggle').tclass('checked',!!value)};types.exec={};types.exec.init=function(){self.event('click',cls2+'-'+(config.style===2?'t':'')+'exec',function(){var t=this,el=$(t);var item=self.finditem(t);if(!item.disabled&&item.exec)self.EXEC(item.exec,item,el)})};types.exec.render=function(item,next){next('<div class="{0}-exec">{1}<i class="fa fa-angle-right"></i></div>'.format(cls,item.value?Thelpers.encode(item.value):''))};types.text={};types.text.render=function(item,next){next('<div class="{0}-text">{1}</div>'.format(cls,item.value?Thelpers.encode(item.value):''))};types.text.set=function(el,value){el.find(cls2+'-text').html(value?Thelpers.encode(value):'')};types.list={};types.list.init=function(){if(config.style===2){self.event('click',cls2+'-tlist',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-list').trigger('click')})}self.event('click',cls2+'-list',function(e){e.preventDefault();e.stopPropagation();var t=this,item=self.finditem(t);if(item.disabled)return;var opt={};opt.offsetY=-5;opt.element=$(t);opt.items=typeof(item.items)==='string'?item.items.indexOf('/')===-1?GET(self.makepath(item.items)):item.items:item.items;opt.custom=item.dircustom;opt.minwidth=80;if(item.dirsearch)opt.placeholder=item.dirsearch;else if(item.dirsearch==false)opt.search=false;opt.callback=function(value){if(typeof(value)==='string'){opt.element.find('span').text(value);item.value=value}else{opt.element.find('span').html(value[item.dirkey||'name']);item.value=value[item.dirvalue||'id']}if(item.dircustom&&item.dirappend!==false){if(!opt.items)opt.items=[];if(opt.items.indexOf(item.value)===-1)opt.items.push(item.value)}item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){opt.element.find('span').text(val)});self.modifyval(item);self.change(true);item.required&&self.validate2()};SETTER('directory','show',opt)})};types.list.render=function(item,next){var template='<div class="{0}-list">'+(config.style===2?'':'<i class="fa fa-chevron-down"></i>')+'<span>{1}</span></div>';if(item.detail){AJAX('GET '+item.detail.format(encodeURIComponent(item.value)),function(response){next(template.format(cls,response[item.dirkey||'name']||item.placeholder||DEF.empty))})}else{var arr=typeof(item.items)==='string'?GET(item.items):item.items;var m=(arr||EMPTYARRAY).findValue(item.dirvalue||'id',item.value,item.dirkey||'name',item.placeholder||DEF.empty);next(template.format(cls,m))}};types.list.set=function(el,value,item){var items=typeof(item.items)==='string'?item.items.indexOf('/')===-1?GET(self.makepath(item.items)):item.items:item.items;var val=items instanceof Array?items.findValue(item.dirvalue||'id',value,item.dirkey||'name'):'';el.find('span').text(val)};types.menu={};types.menu.init=function(){if(config.style===2){self.event('click',cls2+'-tmenu',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-menu').trigger('click')})}self.event('click',cls2+'-menu',function(){var t=this,item=self.finditem(t);if(item.disabled)return;var opt={};if(config.style===2)opt.align='right';opt.offsetY=-5;opt.element=$(t);opt.items=typeof(item.items)==='string'?item.items.indexOf('/')===-1?GET(self.makepath(item.items)):item.items:item.items;opt.callback=function(value){if(typeof(value)==='string'){opt.element.find('span').text(value);item.value=value}else{opt.element.find('span').html(value[item.dirkey||'name']);item.value=value[item.dirvalue||'id']}if(item.dircustom&&item.dirappend!==false){if(!opt.items)opt.items=[];if(opt.items.indexOf(item.value)===-1)opt.items.push(item.value)}item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){opt.element.find('span').text(val)});self.modifyval(item);self.change(true);item.required&&self.validate2()};SETTER('menu','show',opt)})};types.menu.render=function(item,next){var template='<div class="{0}-menu">'+(config.style===2?'':'<i class="fa fa-chevron-down"></i>')+'<span>{1}</span></div>';if(item.detail){AJAX('GET '+item.detail.format(encodeURIComponent(item.value)),function(response){next(template.format(cls,response[item.dirkey||'name']||item.placeholder||DEF.empty))})}else{var arr=typeof(item.items)==='string'?GET(item.items):item.items;var m=(arr||EMPTYARRAY).findValue(item.dirvalue||'id',item.value,item.dirkey||'name',item.placeholder||DEF.empty);next(template.format(cls,m))}};types.menu.set=function(el,value,item){var items=typeof(item.items)==='string'?item.items.indexOf('/')===-1?GET(self.makepath(item.items)):item.items:item.items;var val=items instanceof Array?items.findValue(item.dirvalue||'id',value,item.dirkey||'name'):'';el.find('span').text(val)};types.color={};types.color.init=function(){if(config.style===2){self.event('click',cls2+'-tcolor',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-colortoggle').trigger('click')})}self.event('click',cls2+'-colortoggle',function(e){e.preventDefault();e.stopPropagation();var t=this,item=self.finditem(t);if(item.disabled)return;var opt={};opt.align=config.modalalign;opt.element=$(t);opt.callback=function(value){opt.element.find('b').css('background-color',value);item.value=value;item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){opt.element.find('b').css('background-color',val)});self.modifyval(item);self.change(true);item.required&&self.validate2()};SETTER('colorpicker','show',opt)})};types.color.render=function(item,next){next('<div class="{0}-color"><span class="{0}-colortoggle"><b{1}>&nbsp;</b></span></div>'.format(cls,item.value?(' style="background-color:'+item.value+'"'):''))};types.color.set=function(el,value){el.find('b').css('background-color',value||'')};types.fontawesome={};types.fontawesome.init=function(){if(config.style===2){self.event('click',cls2+'-tfontawesome',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-fontawesometoggle').trigger('click')})}self.event('click',cls2+'-fontawesometoggle',function(e){e.preventDefault();e.stopPropagation();var t=this,item=self.finditem(t);if(item.disabled)return;var opt={};opt.align=config.modalalign;opt.element=$(t);opt.callback=function(value){opt.element.find('i').rclass().aclass(value);item.value=value;item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){opt.element.find('i').rclass().aclass(val)});self.modifyval(item);self.change(true);item.required&&self.validate2()};SETTER('faicons','show',opt)})};types.fontawesome.render=function(item,next){next('<div class="{0}-fontawesome"><span class="{0}-fontawesometoggle"><i class="{1}"></i></span></div>'.format(cls,item.value||''))};types.fontawesome.set=function(el,value){el.find('i').rclass2('fa').class(value||'')};types.emoji={};types.emoji.init=function(){if(config.style===2){self.event('click',cls2+'-temoji',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-emojitoggle').trigger('click')})}self.event('click',cls2+'-emojitoggle',function(e){e.preventDefault();e.stopPropagation();var t=this,item=self.finditem(t);if(item.disabled)return;var opt={};opt.align=config.modalalign;opt.element=$(t);opt.callback=function(value){opt.element.html(value);item.value=value;item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){opt.element.html(val)});self.modifyval(item);self.change(true);item.required&&self.validate2()};SETTER('emoji','show',opt)})};types.emoji.render=function(item,next){next('<div class="{0}-emoji"><span class="{0}-emojitoggle">{1}</span></div>'.format(cls,item.value||DEF.empty))};types.emoji.set=function(el,value){el.find('span').html(value||DEF.empty)};types.file={};types.file.init=function(){if(config.style===2){self.event('click',cls2+'-tfile',function(e){e.stopPropagation();e.preventDefault();$(this).find(cls2+'-file').trigger('click')})}self.event('click',cls2+'-file',function(e){e.preventDefault();e.stopPropagation();var t=this,item=self.finditem(t);if(item.disabled)return;var file=$('#propertiesupload');if(item.accept)file.attr('accept',item.accept);else file.removeAttr('accept');file.off('change').on('change',function(){var file=this,data=new FormData();data.append('file',file.files[0]);SETTER('loading','show');UPLOAD(item.url,data,function(response){item.value=response;item.changed=item.prev!==item.value;self.findel(t).tclass(cls+'-changed',item.changed);config.change&&self.EXEC(config.change,item,function(val){self.findel(t).find(cls2+'-filename').text(val)});SETTER('loading','hide',1000);file.value='';self.modifyval(item);self.change(true);item.required&&self.validate2()})}).trigger('click')})};types.file.render=function(item,next){next('<div class="{0}-file"><i class="far fa-folder"></i><span class="{0}-filename">{1}</span></div>'.format(cls,item.filename||item.value||DEF.empty))};self.render=function(item,index){var type=types[item.type==='boolean'?'bool':item.type],c=cls;if(item.show){if(!funcs[item.name+'_show'](values))c='hidden '+c}var meta={label:item.label,type:item.type};if(item.icon){var tmp=item.icon,color;tmp=tmp.replace(/#[a-f0-9]+/gi,function(text){color=text;return''}).trim();tmp=self.faicon(tmp);meta.icon=Tangular.render('<i class="{{ icon}}"{{ if color}} style="{{ type}}color:{{ color}}"{{ fi}}></i>',{icon:tmp,color:color,type:config.style===2?'background-':''})}else meta.icon='';var plus='';if(item.ricon)plus='<div class="{0}-ricon">{1}</div>'.format(cls,item.ricon.charAt(0)==='!'?item.ricon.substring(1):'<i class="{0}"></i>'.format(item.ricon));var el=$(('<div class="{2}-item{3} {2}-t{type}'+(item.required?' {2}-required':'')+(item.icon?' {2}-isicon':'')+(item.note?' {2}-isnote':'')+'" data-index="{1}">'+(config.style===2?'{{ icon}}<div>':'')+'<div class="{0}-key">'+(config.style===2?'':'{{ icon}}')+'{{ label}}</div>'+(config.style===2?(plus+'<div class="{0}-value">&nbsp;</div><div class="{0}-note">{1}</div>').format(cls,config.encodenotes?Thelpers.encode(item.note):item.note):(plus+'<div class="{0}-value">&nbsp;</div>'))+'</div>'+(config.style===2?'</div>':'')).format(cls,index,c,item.required?(' '+cls+'-required'):'').arg(meta));if(plus)el.aclass(cls+'-isricon');if(item.align)el.find(cls2+'-value').aclass(item.align);type.render(item,function(html){if(item.note&&config.style!==2)html+='<div class="{0}-note">{1}</div>'.format(cls,item.note);el.find(cls2+'-value').html(html);item.disabled&&el.aclass('ui-disabled')},el);return el};self.setter=function(value,path){var p=path.substring(self.path.length+1);if(skip||(p&&!paths[p])){skip=false;return}if(!value)value=EMPTYARRAY;var groups={},items=datasource||value,is=!datasource||!rendered;if(is)container.empty();values={};funcs={};for(var i=0;i<items.length;i++){var item=items[i],g=item.group||'Default',val=datasource?value[item.name]:item.value;item.invalid=false;if(!groups[g])groups[g]={html:[]};switch(item.type){case'fontawesome':case'string':item.prev=val||'';break;case'date':item.prev=val?val.format(config.dateformat):null;break;default:item.prev=val;break}if(item.show&&is)funcs[item.name+'_show']=typeof(item.show)==='string'?FN(item.show):item.show;values[item.name]=val;if(item.required)item.invalid=!val;if(is){item.value=val;groups[g].html.push(self.render(item,i))}else{if(!item.element)item.element=self.find(cls2+'-item[data-index="{0}"]'.format(i));types[item.type].set(item.element,val,item)}}if(is){for(var key in groups){var group=groups[key],hash='g'+HASH(key,true);var el=$('<div class="{0}-group" data-id="{2}"><label>{1}</label><section></section></div>'.format(cls,key,hash));var section=el.find('section');for(var j=0;j<group.html.length;j++)section.append(group.html[j]);container.append(el)}}if(!is){self.find(cls2+'-item').rclass(cls+'-invalid '+cls+'-changed');for(var i=0;i<items.length;i++){var item=items[i];if(item.show){var can=funcs[item.name+'_show'](values);self.find(cls2+'-item[data-index="{0}"]'.format(i)).tclass('hidden',!can)}}}self.validate2();rendered=true}});</script>