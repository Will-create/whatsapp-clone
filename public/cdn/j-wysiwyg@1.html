<style>.ui-wysiwyg-toolbar{border-radius:var(--radius) var(--radius) 0 0;border:1px solid #E0E0E0;height:45px;padding-left:10px}.ui-wysiwyg-toolbar button{float:left;width:24px;height:24px;line-height:24px;outline:0;text-align:center;border:0;background-color:#FFF;margin:10px 5px 0 0;font-size:12px;border-radius:var(--radius)}.ui-wysiwyg-toolbar button:hover,.ui-wysiwyg-toolbar button.selected{background-color:#F0F0F0}.ui-wysiwyg-body{outline:0;background-color:#FFF;color:#000;border:1px solid #E0E0E0;border-top:0;padding:15px 10px;border-radius:0 0 var(--radius) var(--radius);position:relative;display:inline-block;width:100%}.ui-wysiwyg-placeholder{position:absolute;margin:15px 0 0 15px;color:#A0A0A0;cursor:text;z-index:1}.ui-wysiwyg .marked{background-color:rgba(0,0,0,0.1);padding:0 2px;border-radius:var(--radius)}.ui-wysiwyg code{font-family:Menlo,Consolas,monospace;color:#000;font-size:13px;background-color:#F0F0F0;padding:0 3px;border-radius:var(--radius)}.ui-dark .ui-wysiwyg-toolbar{border-color:#404040}.ui-dark .ui-wysiwyg-toolbar button{background-color:#202020;color:#D0D0D0}.ui-dark .ui-wysiwyg-toolbar button:hover,.ui-dark .ui-wysiwyg-toolbar button.selected{background-color:#303030}.ui-dark .ui-wysiwyg-body{background-color:#232323;color:#D0D0D0;border-color:#404040}.ui-dark .ui-wysiwyg-placeholder{color:#A0A0A0}.ui-dark .ui-wysiwyg .marked{background-color:rgba(255,255,255,0.2);color:#FFF}.ui-dark .ui-wysiwyg code{color:#D0D0D0;background-color:#404040}</style>
<script>COMPONENT('wysiwyg@1',function(self,config,cls){var cls2='.'+cls,timers={},buttons={},D=document,skip=false,placeholder,editor;function selectall(el){var doc=W.document,sel,range;if(W.getSelection&&doc.createRange){sel=W.getSelection();range=doc.createRange();range.selectNodeContents(el);sel.removeAllRanges();sel.addRange(range)}else if(doc.body.createTextRange){range=doc.body.createTextRange();range.moveToElementText(el);range.select()}}var findparent=function(node){while(node){if(node===editor[0])return;if(node.parentNode===editor[0])return node;node=node.parentNode}};var check=function(node,tag){while(node){if(node===editor[0])return;if(node.tagName===tag)return node;node=node.parentNode}};var clean=function(node){var tag=D.createTextNode($(node).text());editor[0].replaceChild(tag,node);selectall(tag)};self.validate=function(value){var type=typeof(value);if(type==='undefined'||type==='object')value='';else value=value.toString();EMIT('reflow',self.name);return value.length>0};self.make=function(){self.aclass(cls);self.attr('wysiwyg','true');self.append('<div class="{0}-toolbar"><button name="bold"><i class="fa fa-bold"></i></button><button name="italic"><i class="fa fa-italic"></i></button><button name="underline"><i class="fa fa-underline"></i></button></button><button name="link"><i class="fa fa-link"></i></button><button name="code"><i class="fa fa-highlighter"></i></button></div><div class="{0}-placeholder">{1}</div><div class="{0}-body" contenteditable="true"></div>'.format(cls,config.placeholder));editor=self.find(cls2+'-body');placeholder=self.find(cls2+'-placeholder');placeholder.on('click',function(){placeholder.aclass('hidden');editor.focus()});self.find('button').on('click',function(){switch(this.name){case'bold':D.execCommand('Bold',false,null);break;case'italic':D.execCommand('Italic',false,null);break;case'underline':D.execCommand('Underline',false,null);break;case'mark':var node=self.getNode();var tag=check(node,'SPAN');if(tag){clean(tag)}else{var selection=self.getSelection();selection&&D.execCommand('insertHtml',false,'<span class="marked">{0}</span>'.format(node===editor[0]?selection:node.innerHTML))}break;case'code':var node=self.getNode();var tag=check(node,'CODE');if(tag){clean(tag)}else{var selection=self.getSelection();selection&&D.execCommand('insertHtml',false,'<code>{0}</code>'.format(node===editor[0]?selection:node.innerHTML))}break;case'clean':var selection=self.getSelection();if(selection){node=self.getSelection(true)}else{node=findparent(self.getNode());node&&clean(node)}break;case'link':var node=self.getNode();var tag=check(node,'A');if(tag){clean(tag)}else{var id='#URL'+Date.now();var html=self.getSelection();if(html){D.execCommand('CreateLink',false,id);var a=self.find('a[href="{0}"]'.format(id)).attr('target','_blank').attr('href',html);self.event('link',a)}}break}}).each(function(){buttons[this.name]=this});var el=self.element;el.on('selectstart',function(){clearTimeout(timers.selection);timers.selection=setTimeout(function(){self.event('select',self.getSelection())},500)});editor.on('focus',function(){clearTimeout(timers.focused);clearInterval(timers.changes);timers.changes=null;self.focused=true;self.event('focus',self);placeholder.aclass('hidden')});self.save=function(){skip=true;self.getter(editor.html())};editor.on('click',function(e){e.target&&self.event('click',e.target)});editor.on('blur',function(){var t=editor.text().trim();placeholder.tclass('hidden',!!t);clearTimeout(timers.focused);clearInterval(timers.changes);timers.changes=null;self.save();timers.focused=setTimeout(function(){self.event('blur',self)},200)});editor.on('paste',function(e){e.preventDefault();e.stopPropagation();var text=e.originalEvent.clipboardData.getData(self.attrd('clipboard')||'text/plain');self.event('paste',text)});editor.on('keydown',function(e){if(!timers.changes)timers.changes=setInterval(self.save,1000);if(!e.metaKey&&!e.ctrlKey)return;if(e.which===66){D.execCommand('Bold',false,null);e.preventDefault();e.stopPropagation();return}if(e.which===76){e.preventDefault();e.stopPropagation();var html=self.getSelection();if(html){var id='#URL'+Date.now();D.execCommand('CreateLink',false,id);var a=self.find('a[href="{0}"]'.format(id)).attr('target','_blank').attr('href',html);self.event('link',a)}return}if(e.which===73){D.execCommand('Italic',false,null);e.preventDefault();e.stopPropagation();return}if(e.which===85){D.execCommand('Underline',false,null);e.preventDefault();e.stopPropagation();return}});var notify=function(e){timers.notify=null;self.event('cursor',e.target)};el.on('keydown',function(e){timers.notify&&clearTimeout(timers.notify);timers.notify=setTimeout(notify,100,e)})};self.exec=function(){D.execCommand.apply(D,arguments);return self};self.insert=function(value,encoded){D.execCommand(encoded?'insertText':'insertHtml',false,value);return self};var loadformat=function(){var node=self.getNode();var toolbar={};while(node){if(node===editor[0])return toolbar;switch(node.tagName){case'B':toolbar.bold=1;break;case'I':toolbar.italic=1;break;case'A':toolbar.link=1;break;case'SPAN':toolbar.mark=1;break;case'CODE':toolbar.code=1;break;case'S':toolbar.strike=1;break;case'U':toolbar.underline=1;break}node=node.parentNode}return toolbar};self.event=function(type,value){if(type==='click'||type==='cursor'){var format=loadformat(self.getNode());var keys=Object.keys(buttons);for(var i=0;i<keys.length;i++){var key=keys[i],btn=buttons[key],is=format[key]===1;if(btn.prevstate!==is){if(is)btn.classList.add('selected');else btn.classList.remove('selected');btn.prevstate=is}}}if(type==='paste')self.insert(value,true)};self.getNode=function(){var node=D.getSelection().anchorNode;if(node)return(node.nodeType===3?node.parentNode:node)};self.getSelection=function(node){if(D.selection&&D.selection.type==='Text')return D.selection.createRange().htmlText;else if(!W.getSelection)return;var sel=W.getSelection();if(!sel.rangeCount)return'';var container=D.createElement('div');for(var i=0,len=sel.rangeCount;i<len;++i)container.appendChild(sel.getRangeAt(i).cloneContents());return node?container:container.innerHTML};self.focus=function(){editor.focus()};self.setter=function(value,path,type){if(skip&&type===2){skip=false;return}var val=value?(value+'').trim():'';self.reset();editor.html(val);placeholder.tclass('hidden',!!val)};self.state=function(type){if(!type)return;var invalid=self.isInvalid();if(invalid!==self.$oldstate){self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)}}});</script>