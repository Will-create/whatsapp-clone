<style>.ui-dropdowncheckbox-container{display:block;text-align:left;position:relative;font-size:14px}.ui-dropdowncheckbox{border:1px solid #E0E0E0;padding:0 10px;border-radius:var(--radius);outline:0;overflow:hidden;width:100%;background-color:#FFF;height:32px;cursor:pointer}.ui-dropdowncheckbox div{padding:5px 0 0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#000}.ui-dropdowncheckbox>i{float:right;width:22px;text-align:right;margin:0;padding:6px 1px 8px 0;font-size:17px;border-left:1px solid #E0E0E0;color:#000}.ui-dropdowncheckbox-label i{width:14px}.ui-dropdowncheckbox-label{margin-bottom:3px;font-size:12px}.ui-dropdowncheckbox-placeholder{color:#686868}.ui-dropdowncheckbox-required{border-color:#D0D0D0}.ui-dropdowncheckbox-required .ui-dropdowncheckbox{border-color:#D0D0D0}.ui-dropdowncheckbox-required .ui-dropdowncheckbox-label:before{color:red;content:'***';margin-right:5px}.ui-dropdowncheckbox-required .ui-dropdowncheckbox-label{font-weight:bold}.ui-dropdowncheckbox-required .ui-dropdowncheckbox i{border-left-color:#D0D0D0}.ui-dropdowncheckbox-values{position:absolute;width:100%;z-index:2;background-color:#FFF;border:1px solid #D0D0D0;padding:5px 10px;border-radius:0 0 var(--radius) var(--radius);line-height:18px;margin-top:-1px;box-shadow:0 3px 5px rgba(0,0,0,0.08);overflow:auto;max-height:250px;font-size:12px}.ui-dropdowncheckbox-item{cursor:pointer;padding-bottom:2px}.ui-dropdowncheckbox-item span{cursor:pointer;vertical-align:middle;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block;margin-left:20px}.ui-dropdowncheckbox-item div{float:left;width:16px;height:16px;border:1px solid #E0E0E0;margin:1px 6px 0 0;vertical-align:middle;cursor:pointer;color:#FFF;font-size:11px;text-align:center;padding:1px 0 0 1px;background-color:#FFF;border-radius:var(--radius)}.ui-dropdowncheckbox-item i{display:none}.ui-dropdowncheckbox-checked div{background-color:#4285F4;border-color:#4285F4}.ui-dropdowncheckbox-checked i{display:block !important}.ui-dropdowncheckbox-invalid .ui-dropdowncheckbox{border:1px solid #E1A1A1 !important;background-color:#FFF3F3 !important}.ui-dropdowncheckbox-invalid .ui-dropdowncheckbox i{border-left-color:#E1A1A1 !important}.ui-dropdowncheckbox-values-empty{text-align:center;padding:10px 0;color:#A0A0A0}.ui-disabled .ui-dropdowncheckbox-selected{color:#A0A0A0;cursor:not-allowed}.ui-disabled .ui-dropdowncheckbox{background-color:#F0F0F0}.ui-disabled .ui-dropdowncheckbox i{color:#A0A0A0;cursor:not-allowed}.ui-dark .ui-dropdowncheckbox{border-color:#404040;background-color:#303030;color:#FFF}.ui-dark .ui-dropdowncheckbox i{border-left-color:#404040;color:gray}.ui-dark .ui-dropdowncheckbox-placeholder{color:gray}.ui-dark .ui-dropdowncheckbox-values{background-color:#303030;border-color:#404040}.ui-dark .ui-dropdowncheckbox-item div{border-color:#3A3A3A;background-color:#303030}.ui-dark .ui-dropdowncheckbox-checked div{background-color:#4285F4;border-color:#4285F4}.ui-dark .ui-dropdowncheckbox div{color:#FFF}.ui-dark .ui-dropdowncheckbox-invalid .ui-dropdowncheckbox{border:1px solid #404040 !important;background-color:#303030 !important}.ui-dark .ui-dropdowncheckbox-invalid .ui-dropdowncheckbox i{border-left-color:#404040 !important}</style>
<script>COMPONENT('dropdowncheckbox','checkicon:check;visible:0;alltext:All selected;limit:0;selectedtext:{0} selected',function(self,config,cls){var cls2='.'+cls,data=[],render='',container,values,content,datasource=null,prepared=false,W=window;!W.$dropdowncheckboxtemplate&&(W.$dropdowncheckboxtemplate=Tangular.compile('<div class="'+cls+'-item" data-index="{{ index}}"><div><i class="fa fa-{{ $.checkicon}}"></i></div><span>{{ text}}</span></div>'));var template=W.$dropdowncheckboxtemplate;self.nocompile&&self.nocompile();self.validate=function(value){return config.disabled||!config.required?true:value&&value.length>0};self.configure=function(key,value,init){if(init)return;var redraw=false;switch(key){case'type':self.type=value;break;case'required':self.tclass(cls+'-required',config.required);break;case'label':content=value;redraw=true;break;case'disabled':self.tclass('ui-disabled',value);self.reset();break;case'checkicon':self.find('i').rclass().aclass(value.indexOf(' ')===-1?('fa fa-'+value):value);break;case'icon':redraw=true;break;case'datasource':self.datasource(value,self.bind);datasource&&self.refresh();datasource=value;break;case'items':if(value instanceof Array){self.bind('',value);return}var items=[];value.split(',').forEach(function(item){item=item.trim().split('|');var val=(item[1]==null?item[0]:item[1]).trim();if(config.type==='number')val=+val;items.push({name:item[0].trim(),id:val})});self.bind('',items);self.refresh();break}redraw&&setTimeout2(self.id+'.redraw',self.redraw,100)};self.redraw=function(){var html='<div class="{0}"><i class="fa fa-angle-down"></i><div class="{0}-selected"></div></div><div class="{0}-values hidden">{1}</div>'.format(cls,render);if(content.length)self.html('<div class="{0}-label">{1}{2}:</div>'.format(cls,config.icon?('<i class="'+(config.icon.indexOf(' ')===-1?('fa fa-'+config.icon):config.icon)+'"></i>'):'',content)+html);else self.html(html);container=self.find(cls2+'-values');values=self.find(cls2+'-selected');prepared&&self.refresh();self.tclass('ui-disabled',config.disabled===true);self.tclass(cls+'-required',config.required===true)};self.make=function(){self.type=config.type;content=self.html();self.aclass(cls+'-container');self.redraw();if(config.items)self.reconfigure({items:config.items});else if(config.datasource)self.reconfigure({datasource:config.datasource});else self.bind('',null);self.event('click',cls2,function(e){if(config.disabled)return;container.tclass('hidden');if(W.$dropdowncheckboxelement){W.$dropdowncheckboxelement.aclass('hidden');W.$dropdowncheckboxelement=null}!container.hclass('hidden')&&(W.$dropdowncheckboxelement=container);e.stopPropagation()});self.event('click',cls2+'-item',function(e){e.stopPropagation();if(config.disabled)return;var el=$(this);var is=!el.hclass(cls+'-checked');var index=+el.attrd('index');var value=data[index];if(value===undefined)return;value=value.value;var arr=self.get();if(!(arr instanceof Array))arr=[];var index=arr.indexOf(value);if(is){if(config.limit&&arr.length===config.limit)return;index===-1&&arr.push(value)}else{index!==-1&&arr.splice(index,1)}self.set(arr);self.change(true)})};self.bind=function(path,value){var clsempty=cls+'-values-empty';if(value!==undefined)prepared=true;if(!value||!value.length){var h=config.empty||'&nbsp;';if(h===self.old)return;container.aclass(clsempty).html(h);self.old=h;return}var kv=config.value||'id',kt=config.text||'name';render='';data=[];for(var i=0,length=value.length;i<length;i++){var isString=typeof(value[i])==='string';var item={value:isString?value[i]:value[i][kv],text:isString?value[i]:value[i][kt],index:i};render+=template(item,config);data.push(item)}var h=HASH(render);if(h===self.old)return;self.old=h;if(render)container.rclass(clsempty).html(render);else container.aclass(clsempty).html(config.empty);self.refresh()};self.setter=function(value){if(!prepared)return;var label='',count=value==null||!value.length?undefined:value.length;if(value&&count){var remove=[];for(var i=0;i<count;i++){var selected=value[i],index=0,is=false;while(true){var item=data[index++];if(item===undefined)break;if(item.value!=selected)continue;label+=(label?', ':'')+item.text;is=true}!is&&remove.push(selected)}if(config.cleaner!==false&&value){var refresh=false;while(true){var item=remove.shift();if(item===undefined)break;value.splice(value.indexOf(item),1);refresh=true}refresh&&self.set(value)}}container.find(cls2+'-item').each(function(){var el=$(this);var index=+el.attrd('index');var checked=false;if(!value||!value.length)checked=false;else if(data[index])checked=data[index];checked&&(checked=value.indexOf(checked.value)!==-1);el.tclass(cls+'-checked',checked)});if(!label&&value&&config.cleaner!==false){self.rewrite([])}if(!label&&config.placeholder){values.rattr('title','');values.html('<span class="{1}-placeholder">{0}</span>'.format(config.placeholder,cls))}else{if(count==data.length&&config.alltext!=='null'&&config.alltext)label=config.alltext;else if(config.visible&&count>config.visible)label=config.selectedtext.format(count,data.length);values.attr('title',label);values.html(label)}};self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)};if(!W.$dropdowncheckboxevent){W.$dropdowncheckboxevent=true;$(document).on('click',function(){if(W.$dropdowncheckboxelement){W.$dropdowncheckboxelement.aclass('hidden');W.$dropdowncheckboxelement=null}})}});</script>