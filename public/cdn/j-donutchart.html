<style>.ui-donutchart{position:relative}.ui-donutchart-tooltip{position:absolute;left:50%;text-align:center;width:60%;margin:-8% 0 0 -30%;top:50%}.ui-donutchart .piece{transition:stroke-width 0.2s}.ui-donutchart .piece1{stroke:#3182BD;fill:none}.ui-donutchart .piece2{stroke:#FD8D3C;fill:none}.ui-donutchart .piece3{stroke:#74C476;fill:none}.ui-donutchart .piece4{stroke:#9E9AC8;fill:none}.ui-donutchart .piece5{stroke:#969696;fill:none}.ui-donutchart .selected{}</style>
<script>COMPONENT('donutchart','format:{{ value | format(0) }};size:0;tooltip:1;presentation:1;animate:0;highlight:1',function(self,config,cls){var cls2='.'+cls,svg,g,selected,tooltip,strokew=0,animate=true,indexer=0,indexerskip=false,force=false;self.readonly();self.nocompile();self.make=function(){self.aclass(cls);self.append('<div class="'+cls+'-tooltip"></div><svg></svg>');svg=self.find('svg');g=svg.asvg('g').attr('class','pieces');tooltip=self.find(cls2+'-tooltip');self.on('resize + resize2',self.resize);self.event('mouseenter touchstart','.piece',function(){self.select(+this.getAttribute('data-index'));!indexerskip&&config.presentation&&setTimeout2(self.id+'.skip',self.next,30000);indexerskip=true})};self.select=function(index){var item=self.get()[index];if(item===selected)return;self.find('.selected').rclass('selected').css('stroke-width',strokew);selected=item;var el=self.find('.piece'+(index+1));if(config.tooltip){var w=self.width();tooltip.css('font-size',w/15);tooltip.html('<b>'+item.name+'</b><br />'+Tangular.render(config.format,item))}config.select&&self.EXEC(config.select,item);config.highlight&&el.css('stroke-width',strokew.inc('+15%'));el.aclass('selected');indexer=index};self.resize=function(){setTimeout2('resize.'+self.id,function(){animate=false;force=true;self.refresh()},100)};self.next=function(){if(self.removed)return;if(indexerskip){indexerskip=false;return}indexer++;var tmp=self.get();if(!tmp)return;if(!tmp[indexer])indexer=0;self.select(indexer);setTimeout2(self.id+'.next',self.next,4000)};function arcradius(centerX,centerY,radius,degrees){var radians=(degrees-90)*Math.PI/180.0;return{x:centerX+(radius*Math.cos(radians)),y:centerY+(radius*Math.sin(radians))}}function arc(x,y,radius,startAngle,endAngle){var start=arcradius(x,y,radius,endAngle);var end=arcradius(x,y,radius,startAngle);var largeArcFlag=endAngle-startAngle<=180?0:1,d=['M',start.x,start.y,'A',radius,radius,0,largeArcFlag,0,end.x,end.y].join(' ');return d}self.redraw=function(width,value){var sum=null;for(var i=0,length=value.length;i<length;i++){var item=value[i];if(item.value==null)item.value=0;var val=item.value+1;sum=sum?sum+val:val}var count=0,beg=0,end=0,items=[];for(var i=0,length=value.length;i<length;i++){var item=value[i],p=(((item.value+1)/sum)*100).floor(2);count+=p;if(i===length-1&&count<100)p=p+(100-count);end=beg+((360/100)*p);items.push({name:item.name,percentage:p,beg:beg,end:end});beg=end}if(!force&&NOTMODIFIED(self.id,items))return;var size=width,half=size/2,midpoint=size/2.4;strokew=(size/6>>0).inc('-15%');svg.attr('width',size);svg.attr('height',size);g.empty();var pieces=[];for(var i=0,length=items.length;i<length;i++){var item=items[i];if(item.percentage===0)continue;if(item.end===360)item.end=359.99;pieces.push(g.asvg('path').attrd('index',i).attrd('beg',item.beg).attrd('end',item.end).attr('stroke-width',strokew).attr('class','piece piece'+(i+1)).attr('d',arc(half,half,midpoint,item.beg,animate?item.beg:item.end)))}animate&&pieces.wait(function(item,next){var beg=+item.attrd('beg');var end=+item.attrd('end');var diff=end-beg;if(config.animate){item.animate({end:diff},{duration:180,step:function(fx){item.attr('d',arc(half,half,midpoint,beg,beg+fx))},complete:function(){next()}})}else{item.attr('d',arc(half,half,midpoint,beg,end));next()}});selected=null;animate=true;force=false;config.redraw&&self.EXEC(config.redraw);self.select(0);if(config.presentation){indexerskip=false;setTimeout(self.next,4000)}};self.setter=function(value){if(!value){g.empty();return}if(config.size){var w=typeof(config.size)==='string'?self.parent(config.size).width():config.size;self.redraw(w,value)}else{self.width(function(width){self.redraw(width-(config.margin||0),value)})}}});</script>