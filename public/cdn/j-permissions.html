<style>.ui-permissions-header{height:36px;cursor:pointer;color:gray}.ui-permissions-header:hover{color:#000}.ui-permissions-header .green{float:right;width:30px;line-height:35px;text-align:right}.ui-permissions-header span{margin:0 30px 0 0;display:block;line-height:35px}.ui-permissions table{width:100%;table-layout:fixed;font-size:12px}.ui-permissions tr{border-top:1px solid #E0E0E0}.ui-permissions td{border-left:1px solid #E0E0E0;padding:4px 8px}.ui-permissions tr:first-child{border-top:0}.ui-permissions td:first-child{border-left:0}.ui-permissions .fa-times{margin-right:5px;cursor:pointer}.ui-permissions-type{width:40px;color:#A0A0A0;font-size:10px;cursor:pointer;text-align:center;padding-left:0 !important;padding-right:0 !important}.ui-permissions-type i{margin-right:3px;color:#E0E0E0}.ui-permissions-type i:before{content:'\f111'}.ui-permissions-checked{background-color:#FFFED5;color:#000}.ui-permissions-checked i{color:#68B25B}.ui-permissions-empty{color:#A0A0A0;padding:10px 20px !important;text-align:center}.ui-permissions-empty i{margin-right:5px}.ui-permissions-type.ui-permissions-checked i:before{content:'\f058'}.ui-permissions-container{border:1px solid #E0E0E0;border-radius:var(--radius)}.ui-permissions-disabled .green{display:none}.ui-permissions-disabled .ui-permissions-header:hover{cursor:default;color:gray}.ui-permissions-disabled .ui-permissions-type{cursor:not-allowed}.ui-permissions-disabled .fa-times{display:none}.ui-dark .ui-permissions-container{border-color:#404040}.ui-dark .ui-permissions tr{border-color:#404040;background-color:#252525}.ui-dark .ui-permissions td{border-color:#404040}.ui-dark .ui-permissions-checked{background-color:#313131;color:#FFF}.ui-dark .ui-permissions-header:hover{color:#FFF}</style>
<script>COMPONENT('permissions','placeholder:Search;types:R,W,RW;default:R',function(self,config){var cls='ui-permissions',cls2='.'+cls,tbody,skip=false;self.configure=function(key,value){switch(key){case'disabled':self.tclass(cls+'-disabled',value);break}};self.make=function(){self.aclass(cls);config.disabled&&self.aclass(cls+'-disabled');var builder=['<tr data-index="{{Â index}}"><td class="{0}-text"><i class="fa fa-times red"></i>{{ text | raw}}</td>'],types=config.types.split(',').trim();for(var i=0;i<types.length;i++)builder.push('<td class="{0}-type{{ if value === \'{1}\' }} {0}-checked{{ fi}}" data-type="{1}"><i class="far"></i>{1}</td>'.format(cls,types[i]));builder.push('</tr>');self.template=Tangular.compile(builder.join('').format(cls));self.html('<div class="{0}-header"><i class="fa fa-plus-circle green"></i><span>{1}</span></div><div class="{0}-container"><table><tbody></tbody></table></div>'.format(cls,self.html()));tbody=self.find('tbody');self.event('click',cls2+'-header',function(){if(config.disabled)return;var opt={};opt.raw=!!config.dirraw;opt.element=$(this);opt.placeholder=config.placeholder;opt.items=GET(config.dirsource);opt.callback=function(value){var items=self.get();if(!items||!items.findItem(config.pk,value[config.pk])){if(!value.text)value.text=value.name;value.value=config.default;value&&self.push(value)}};SETTER('directory','show',opt)});self.event('click',cls2+'-type',function(){if(config.disabled)return;var el=$(this);var tr=el.closest('tr');tr.find(cls2+'-checked').rclass(cls+'-checked');el.aclass(cls+'-checked');var index=+tr.attrd('index');GETU(self.path)[index].value=el.attrd('type')});self.event('click','.fa-times',function(e){if(config.disabled)return;var el=$(this);var index=+el.closest('tr').attrd('index');var items=GETU(self.path);items.splice(index,1)})};self.setter=function(value){if(skip){skip=false;return}tbody.empty();if(!value||!value.length){config.empty&&tbody.append('<tr><td class="{0}-empty"><i class="fa fa-database"></i>{1}</td></tr>'.format(cls,config.empty));return}var types=config.types.split(',');var builder=[];for(var i=0;i<value.length;i++){var item=value[i];builder.push(self.template({index:i,text:item.text||item.name,value:item.value||types[0]||'R'}))}tbody.html(builder.join(''))}});</script>