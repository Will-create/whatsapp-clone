<style>.ui-directory{position:absolute;opacity:0;transition:0.25s transform cubic-bezier(0.23,1,0.32,1);left:-100;top:-100;z-index:100;box-shadow:0 1px 20px rgba(0,0,0,0.1);background-color:#FFF;border-radius:var(--radius);border:1px solid #E0E0E0;overflow:hidden;transition:all 0.2s}.ui-directory-search{height:38px;background:#FFF;border-radius:var(--radius) var(--radius) 0 0;border-bottom:1px solid #E0E0E0;line-height:22px}.ui-directory-search input{width:100%;background-color:#FFF;border:0;font-size:12px;outline:0;padding:0;margin:0;line-height:16px;outline:0}.ui-directory-search>div{margin:0 30px 0 35px;padding:6px 10px 0 0;line-height:24px}.ui-directory-search>span{float:left;width:16px;text-align:center;padding:8px 0 0 12px;font-size:12px}.ui-directory-add{float:right !important;padding-left:0 !important;color:#83c83c;text-align:left !important;font-size:11px !important;cursor:pointer;width:22px !important}.ui-directory-search .fa-times{color:red;cursor:pointer}.ui-directory-visible{opacity:1}.ui-directory-container{height:150px;overflow-x:hidden;overflow-y:auto;overflow-scrolling:touch;margin:0 30px 0 0;padding:0}.ui-directory ul{list-style-type:none;margin:0;padding:0}.ui-directory .selected{background-color:#F8F8F8;color:#000}.ui-directory .current{background-color:#F2F2F2;color:#000}.ui-directory-default li{padding:0 40px 0 10px;height:26px;line-height:26px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-directory li{border-bottom:1px solid #F0F0F0;font-size:12px;background-color:#FFF;cursor:pointer;margin:0}.ui-directory-checkbox{width:16px;height:16px;float:left;border:1px solid #D0D0D0;border-radius:var(--radius);font-size:10px;line-height:16px;margin:4px 6px 0 0;text-align:center;background-color:#FFF}.ui-directory-checkbox i{visibility:hidden}.ui-directory .selected .ui-directory-checkbox{background-color:#4285F4;border-color:#4285F4;color:#FFF}.ui-directory .selected .ui-directory-checkbox i{visibility:visible}.ui-directory li:last-child{border-bottom:0}.ui-directory-search-hidden .ui-directory-search{height:0;overflow:hidden;opacity:0}.ui-dark .ui-directory{background-color:#303030;border-color:#404040;box-shadow:1px 5px 10px rgba(0,0,0,0.2)}.ui-dark .ui-directory-search{background:#303030}.ui-dark .ui-directory li{background-color:#303030;border-color:#404040}.ui-dark .ui-directory-search{border-bottom-color:#404040}.ui-dark .ui-directory-search input{background-color:#303030}.ui-dark .ui-directory-add:hover{color:#FFF}.ui-dark .ui-directory-checkbox{border-color:#484848;background-color:#404040}.ui-dark .ui-directory .selected{background-color:#2D2D2D;color:#FFF}.ui-dark .ui-directory .current{background-color:#373737;color:#FFF}</style>
<script>COMPONENT('directory','minwidth:200',function(self,config,cls){var cls2='.'+cls,container,timeout,icon,plus,skipreset=false,skipclear=false,ready=false,input=null,issearch=false,is=false,selectedindex=0,resultscount=0,skiphide=false,templateE='{{ name | encode | ui_directory_helper}}',templateR='{{ name | raw}}',template='<li data-index="{{ $.index}}" data-search="{{ $.search}}" {{ if selected}} class="current selected{{ if classname}} {{ classname}}{{ fi}}"{{ else if classname}} class="{{ classname}}"{{ fi}}>{{ if $.checkbox}}<span class="'+cls+'-checkbox"><i class="fa fa-check"></i></span>{{ fi}}{0}</li>',templateraw=template.format(templateR);var regstrip=/(&nbsp;|<([^>]+)>)/ig;var parentclass=null,selectedcache=null;template=template.format(templateE);Thelpers.ui_directory_helper=function(val){var t=this;return t.template?(typeof(t.template)==='string'?t.template.indexOf('{{')===-1?t.template:Tangular.render(t.template,this):t.render(this,val)):self.opt.render?self.opt.render(this,val):val};self.template=Tangular.compile(template);self.templateraw=Tangular.compile(templateraw);self.readonly();self.singleton();self.nocompile&&self.nocompile();self.configure=function(key,value,init){if(init)return;switch(key){case'placeholder':self.find('input').prop('placeholder',value);break}};self.make=function(){self.aclass(cls+' hidden');self.append('<div class="{1}-search"><span class="{1}-add hidden"><i class="fa fa-plus"></i></span><span class="{1}-button"><i class="fa fa-search"></i></span><div><input type="text" placeholder="{0}" class="{1}-search-input" name="dir{2}" autocomplete="new-password" /></div></div><div class="{1}-container"><ul></ul></div>'.format(config.placeholder,cls,Date.now()));container=self.find('ul');input=self.find('input');icon=self.find(cls2+'-button').find('.fa');plus=self.find(cls2+'-add');self.event('mouseenter mouseleave','li',function(){if(ready&&!issearch){container.find('li.current').rclass('current');$(this).aclass('current');var arr=container.find('li:visible');for(var i=0;i<arr.length;i++){if($(arr[i]).hclass('current')){selectedindex=i;break}}}});self.event('focus','input',function(){if(self.opt.search===false)$(this).blur()});self.event('click',cls2+'-button',function(e){skipclear=false;input.val('');self.search();e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-add',function(){if(self.opt.custom&&self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);self.opt.callback(input.val(),self.opt.element,true);self.hide()}});self.event('click','li',function(e){if(self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);var item=self.opt.items[+this.getAttribute('data-index')];if(self.opt.checkbox){item.selected=!item.selected;if(item.selected)item.selectedts=Date.now();else delete item.selectedts;$(this).tclass('selected',item.selected);if(self.opt.checked){var tmpindex=self.opt.checked.indexOf(item.id);if(item.selected){if(tmpindex===-1)self.opt.checked.push(item.id)}else if(tmpindex!==-1)self.opt.checked.splice(tmpindex,1)}var response=null;if(self.opt.checked){response=self.opt.checked.slice(0)}else{response=[];for(var i=0;i<self.opt.items.length;i++){var m=self.opt.items[i];if(m.selected)response.push(m)}}response.quicksort('selectedts');self.opt.callback(response,self.opt.element,false,e);skiphide=true}else self.opt.callback(item,self.opt.element,false,e)}is=true;if(!self.opt.checkbox){self.hide(0);e.preventDefault();e.stopPropagation()}});var e_click=function(e){if(skiphide){skiphide=false;return}var node=e.target,count=0;if(is){while(true){var c=node.getAttribute('class')||'';if(c.indexOf(cls+'-search-input')!==-1)return;node=node.parentNode;if(!node||!node.tagName||node.tagName==='BODY'||count>3)break;count++}}else{is=true;while(true){var c=node.getAttribute('class')||'';if(c.indexOf(cls)!==-1){is=false;break}node=node.parentNode;if(!node||!node.tagName||node.tagName==='BODY'||count>4)break;count++}}is&&self.hide(0)};var e_resize=function(){is&&self.hide(0)};self.bindedevents=false;self.bindevents=function(){if(!self.bindedevents){$(document).on('click',e_click);$(W).on('resize',e_resize);self.bindedevents=true}};self.unbindevents=function(){if(self.bindedevents){self.bindedevents=false;$(document).off('click',e_click);$(W).off('resize',e_resize)}};self.event('keydown','input',function(e){var o=false;switch(e.which){case 8:skipclear=false;break;case 27:o=true;self.hide();break;case 13:o=true;var sel=self.find('li.current');if(self.opt.callback){self.opt.scope&&M.scope(self.opt.scope);var index=+sel.attrd('index');if(self.opt.custom&&(!sel.length||index===-1))self.opt.callback(this.value,self.opt.element,true);else self.opt.callback(self.opt.items[index],self.opt.element)}self.hide();break;case 38:o=true;selectedindex--;if(selectedindex<0)selectedindex=0;self.move();break;case 40:o=true;selectedindex++;if(selectedindex>=resultscount)selectedindex=resultscount;self.move();break}if(o){e.preventDefault();e.stopPropagation()}});self.event('input','input',function(){issearch=true;setTimeout2(self.ID,self.search,100,null,this.value)});var fn=function(){is&&self.hide(1)};self.on('reflow + scroll + resize + resize2',fn);$(W).on('scroll',fn)};self.move=function(){var counter=0,scroller=container.parent();var li=container.find('li');var hli=0,was=false,last=-1,lastselected=0,plus=0;for(var i=0;i<li.length;i++){var el=$(li[i]);if(el.hclass('hidden')){el.rclass('current');continue}var is=selectedindex===counter;el.tclass('current',is);if(is){hli=(el.innerHeight()||30)+1;plus=(hli*2);was=true;var t=(hli*(counter||1));scroller[0].scrollTop=t-plus}counter++;last=i;lastselected++}if(!was&&last>=0){selectedindex=lastselected;li.eq(last).aclass('current')}};var nosearch=function(){issearch=false};self.nosearch=function(){setTimeout2(self.ID+'nosearch',nosearch,500)};self.search=function(value){if(!self.opt)return;icon.tclass('fa-times',!!value).tclass('fa-search',!value);self.opt.custom&&plus.tclass('hidden',!value);if(!value&&!self.opt.ajax){if(!skipclear)container.find('li').rclass('hidden');if(!skipreset)selectedindex=0;resultscount=self.opt.items?self.opt.items.length:0;self.move();self.nosearch();return}resultscount=0;selectedindex=0;if(self.opt.ajax){var val=value||'';if(self.ajaxold!==val){self.ajaxold=val;setTimeout2(self.ID,function(val){self.opt&&self.opt.ajax(val,function(items){var builder=[],indexer={},item,key=(self.opt.search==true?self.opt.key:(self.opt.search||self.opt.key))||'name';for(var i=0;i<items.length;i++){item=items[i];if(self.opt.exclude&&self.opt.exclude(item))continue;if(self.opt.checked)item.selected=self.opt.checked.indexOf(item.id)!==-1;indexer.index=i;indexer.search=item[key]?item[key].replace(regstrip,''):'';indexer.checkbox=self.opt.checkbox===true;resultscount++;builder.push(self.opt.ta(item,indexer))}if(self.opt.empty){item={};var tmp=self.opt.raw?'<b>{0}</b>'.format(self.opt.empty):self.opt.empty;item[self.opt.key||'name']=tmp;if(!self.opt.raw)item.template='<b>{0}</b>'.format(self.opt.empty);indexer.index=-1;builder.unshift(self.opt.ta(item,indexer))}skipclear=true;self.opt.items=items;container.html(builder);self.move();self.nosearch()})},300,null,val)}}else if(value){value=value.toSearch().split(' ');var arr=container.find('li');for(var i=0;i<arr.length;i++){var el=$(arr[i]);var val=el.attrd('search').toSearch();var is=false;for(var j=0;j<value.length;j++){if(val.indexOf(value[j])===-1){is=true;break}}el.tclass('hidden',is);if(!is)resultscount++}skipclear=true;self.move();self.nosearch()}};self.show=function(opt){if(opt.checked==true)opt.checked=[];var el=opt.element instanceof jQuery?opt.element[0]:opt.element;if(opt.items==null)opt.items=EMPTYARRAY;self.tclass(cls+'-default',!opt.render);if(parentclass){self.rclass(parentclass);parentclass=null}if(opt.classname){self.aclass(opt.classname);parentclass=opt.classname}if(!opt.minwidth)opt.minwidth=200;if(is){clearTimeout(timeout);if(self.target===el){self.hide(1);return}}self.initializing=true;self.target=el;opt.ajax=null;self.ajaxold=null;var element=$(opt.element);var callback=opt.callback,items=opt.items,type=typeof(items);var item;if(type==='string'){items=opt.items=GET(items);type=typeof(items)}if(type==='function'&&callback){type='';opt.ajax=items;items=null}if(!items&&!opt.ajax){self.hide(0);return}setTimeout(self.bindevents,500);self.tclass(cls+'-search-hidden',opt.search===false);self.opt=opt;opt.class&&self.aclass(opt.class);input.val('');var builder=[],selected=null;opt.ta=opt.key?Tangular.compile((opt.raw?templateraw:template).replace(/\{\{\sname/g,'{{ '+opt.key)):opt.raw?self.templateraw:self.template;if(!opt.ajax){var indexer={},key=(opt.search==true?opt.key:(opt.search||opt.key))||'name';for(var i=0;i<items.length;i++){item=items[i];if(typeof(item)==='string')item={name:item,id:item,selected:item===opt.selected};if(opt.exclude&&opt.exclude(item))continue;if(item.selected||opt.selected===item){selected=i;skipreset=true;item.selected=true}else item.selected=false;if(opt.checked&&item.selected)opt.checked.push(item.id);indexer.checkbox=opt.checkbox===true;indexer.index=i;indexer.search=item[key]?item[key].replace(regstrip,''):'';builder.push(opt.ta(item,indexer))}if(opt.empty){item={};var tmp=opt.raw?'<b>{0}</b>'.format(opt.empty):opt.empty;item[opt.key||'name']=tmp;if(!opt.raw)item.template='<b>{0}</b>'.format(opt.empty);indexer.index=-1;builder.unshift(opt.ta(item,indexer))}}self.target=element[0];var w=element.width();var offset=element.offset();var width=w+(opt.offsetWidth||0);if(opt.minwidth&&width<opt.minwidth)width=opt.minwidth;else if(opt.maxwidth&&width>opt.maxwidth)width=opt.maxwidth;ready=false;opt.ajaxold=null;plus.aclass('hidden');self.find('input').prop('placeholder',opt.placeholder||config.placeholder);var scroller=self.find(cls2+'-container').css('width',width+30);container.html(builder);var options={left:0,top:0,width:width};switch(opt.align){case'center':options.left=Math.ceil((offset.left-width/2)+(opt.element.innerWidth()/2));break;case'right':options.left=(offset.left-width)+opt.element.innerWidth();break;default:options.left=offset.left;break}options.top=opt.position==='bottom'?((offset.top-self.height())+element.height()):offset.top;options.scope=M.scope?M.scope():'';if(opt.offsetX)options.left+=opt.offsetX;if(opt.offsetY)options.top+=opt.offsetY;var mw=width,mh=self.height();if(options.left<0)options.left=10;else if((mw+options.left)>WW)options.left=(WW-mw)-10;var dom=opt.element[0].parentNode,restrict=true;while(dom){if(dom.tagName==='BODY'){restrict=false;break}if(dom.classList.contains('ui-scrollbar-area'))break;dom=dom.parentNode}if(options.top<0)options.top=10;else if(restrict&&(mh+options.top)>WH)options.top=(WH-mh)-10;self.css(options);!isMOBILE&&setTimeout(function(){ready=true;if(opt.search!==false)input.focus()},200);setTimeout(function(){self.initializing=false;is=true;if(selected==null)scroller[0].scrollTop=0;else{var h=container.find('li:first-child').innerHeight()+1;var y=(container.find('li.selected').index()*h)-(h*2);scroller[0].scrollTop=y<0?0:y}},100);if(is){self.search();return}selectedindex=selected||0;resultscount=items?items.length:0;skipclear=true;self.search();self.rclass('hidden');setTimeout(function(){if(self.opt&&self.target&&self.target.offsetParent)self.aclass(cls+'-visible');else self.hide(1)},100);skipreset=false};self.hide=function(sleep){if(!is||self.initializing)return;clearTimeout(timeout);timeout=setTimeout(function(){self.unbindevents();self.rclass(cls+'-visible').aclass('hidden');if(self.opt){self.opt.close&&self.opt.close();self.opt.class&&self.rclass(self.opt.class);self.opt=null}is=false},sleep?sleep:100)}});</script>