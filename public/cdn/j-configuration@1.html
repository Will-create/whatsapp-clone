<style>.ui-configuration-group{font-size:16px;font-weight:bold;margin:20px 0 10px;padding:5px 0;border-bottom:2px solid #E0E0E0}.ui-configuration-group i{margin-right:7px}.ui-configuration-group-summary{font-size:12px;color:#777;line-height:15px;margin:5px 0 25px}.ui-configuration-group:first-child{margin-top:0}.ui-configuration-items{margin:0 0 15px 3px;padding-left:20px;border-left:2px solid #F0F0F0}.ui-configuration-items:before{content:' ';width:10px;height:10px;background-color:#F0F0F0;display:block;border-radius:100px;margin:-15px 0 0 -26px}.ui-configuration-items:after{content:' ';width:10px;height:10px;background-color:#F0F0F0;display:block;border-radius:100px;margin:-15px 0 0 -26px}.ui-configuration-button{margin-top:8px}.ui-configuration-button button{font-size:11px;border:1px solid #E0E0E0;border-radius:var(--radius);background-color:#FFF;color:#333;padding:2px 5px;min-width:50px}.ui-configuration-button button:hover{border-color:#D0D0D0}.ui-configuration-button button:disabled{color:#B0B0B0;cursor:not-allowed;border-color:#F0F0F0;background-color:#F8F8F8}.ui-configuration-button i{margin-right:5px}.ui-configuration-item{padding:15px 0 15px;border-bottom:1px solid #E0E0E0}.ui-configuration-monospace{font-family:Menlo, Consolas, monospace}.ui-configuration-item-label{font-size:13px;font-weight:bold}.ui-configuration-item-label i{width:14px;text-align:center;margin-right:5px}.ui-configuration-item-summary{font-size:12px;color:#777;line-height:15px;margin:5px 0}.ui-configuration-item-note{font-size:11px;color:#A0A0A0;line-height:12px;margin:2px 0 0}.ui-configuration-item-control{margin:7px 0}.ui-configuration-noborder{border:0}.ui-configuration-type-string input{border:0;width:100%;height:34px;padding:0 8px;margin:0;outline:0;background-color:transparent;border:1px solid #D0D0D0;border-radius:var(--radius);font-size:12px}.ui-configuration-type-string input:disabled, .ui-configuration-type-number input:disabled{background-color:#F0F0F0;color:#A0A0A0}.ui-configuration-type-multiline textarea{border:0;width:100%;height:34px;padding:8px;margin:0;outline:0;background-color:transparent;border:1px solid #D0D0D0;border-radius:var(--radius);font-size:12px;resize:none;height:100px}.ui-configuration-type-multiline textarea:disabled{background-color:#F0F0F0;color:#A0A0A0}.ui-configuration-type-number input{border:0;width:100%;height:32px;padding:0 8px;margin:0;outline:0;background-color:transparent;border:0;font-size:12px;border-radius:var(--radius)}.ui-configuration-type-number{max-width:200px;width:100%;border-radius:var(--radius);border:1px solid #D0D0D0}.ui-configuration-type-number>div{margin-right:33px}.ui-configuration-type-number>span{float:right;border-left:1px solid #D0D0D0;width:33px;height:32px;text-align:center;padding:4px 0 0}.ui-configuration-type-number>span i{display:block;line-height:12px;cursor:pointer}.ui-configuration-type-number input{text-align:center}.ui-configuration-disabled .ui-configuration-type-number{background-color:#F0F0F0;color:#A0A0A0}.ui-configuration-disabled .ui-configuration-type-number>span i{cursor:not-allowed}.ui-configuration-type-boolean{height:28px;position:relative}.ui-configuration-type-boolean div{width:48px;height:24px;border-radius:100px;float:left;border:1px solid #D0D0D0;margin:0;padding:0;line-height:0;cursor:pointer}.ui-configuration-type-boolean span{border-radius:100px;border:1px solid #D0D0D0;position:absolute;top:0;left:0;height:24px;width:24px;text-align:center;background-color:#F0F0F0;transition:all 0.2s}.ui-configuration-type-boolean i{display:none}.ui-configuration-disabled .ui-configuration-type-boolean div{cursor:not-allowed;background-color:#F0F0F0}.ui-configuration-required .ui-configuration-item-label:before{content:'*';margin-right:5px;color:red}.ui-configuration-checked .ui-configuration-type-boolean div{background-color:var(--color);border-color:var(--color)}.ui-configuration-checked span{left:26px;top:2px;border:0;height:20px;width:20px;line-height:22px;font-size:11px;background-color:#FFF}.ui-configuration-checked i{display:inline-block;color:var(--color)}.ui-configuration-type-color{width:50px;border:1px solid #D0D0D0;border-radius:var(--radius);padding:2px;cursor:pointer}.ui-configuration-type-color div{height:44px;border-radius:var(--radius)}.ui-configuration-disabled .ui-configuration-type-color{cursor:not-allowed}.ui-configuration-type-icon{width:50px;height:50px;border:1px solid #D0D0D0;border-radius:var(--radius);text-align:center;cursor:pointer;line-height:49px;font-size:28px}.ui-configuration-disabled .ui-configuration-type-icon{cursor:not-allowed;color:#A0A0A0}.ui-configuration-type-date{height:28px;position:relative;cursor:pointer;max-width:200px}.ui-configuration-type-date label{position:absolute;font-size:12px;line-height:34px;pointer-events:none;color:#A0A0A0;padding-left:10px}.ui-configuration-type-date div{height:34px;border:1px solid #D0D0D0;margin:0;padding:0;border-radius:var(--radius);font-size:12px;line-height:34px;padding:0 8px;text-align:center}.ui-configuration-type-date span{float:right;width:34px;height:34px;border-left:1px solid #D0D0D0;line-height:34px;text-align:center}.ui-configuration-disabled .ui-configuration-type-date{cursor:not-allowed;color:#A0A0A0}.ui-configuration-disabled .ui-configuration-type-date div{background-color:#F0F0F0}.ui-configuration-type-dropdown{height:28px;position:relative;cursor:pointer}.ui-configuration-type-dropdown label{position:absolute;font-size:12px;line-height:34px;padding:0 10px;pointer-events:none;color:#A0A0A0}.ui-configuration-type-dropdown div{height:34px;border:1px solid #D0D0D0;margin:0;padding:0;border-radius:var(--radius);font-size:12px;line-height:34px;padding:0 8px}.ui-configuration-type-dropdown span{float:right;width:34px;height:34px;border-left:1px solid #D0D0D0;line-height:34px;text-align:center}.ui-configuration-disabled .ui-configuration-type-dropdown{cursor:not-allowed;color:#A0A0A0}.ui-configuration-disabled .ui-configuration-type-dropdown div{background-color:#F0F0F0}.ui-configuration-type-selectable-item{position:relative;display:inline-block;width:80px;height:60px;text-align:center;border:1px solid #D0D0D0;padding:11px 0 0;font-size:11px;margin:5px 5px 0 0;border-radius:var(--radius);cursor:pointer}.ui-configuration-type-selectable-item:hover{background-color:#F8F8F8}.ui-configuration-selected.ui-configuration-type-selectable-item{background-color:var(--color);border-color:var(--color);color:#FFF}.ui-configuration-type-selectable-item i{display:block;font-size:20px;margin-bottom:5px}.ui-configuration-type-selectable-item span{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 5px}.ui-configuration-last{border-bottom:0}.ui-configuration-align-1 input{text-align:center}.ui-configuration-align-2 input{text-align:right}.ui-dark .ui-configuration-group{border-bottom-color:#404040}.ui-dark .ui-configuration-group-summary{color:#777}.ui-dark .ui-configuration-items{border-left-color:#303030}.ui-dark .ui-configuration-items:before{background-color:#303030}.ui-dark .ui-configuration-items:after{background-color:#303030}.ui-dark .ui-configuration-button button{border-color:#404040;background-color:#202020;color:#F0F0F0}.ui-dark .ui-configuration-button button:hover{border-color:#454545}.ui-dark .ui-configuration-button button:disabled{color:#777;border-color:#303030;background-color:#383838}.ui-dark .ui-configuration-item{border-bottom-color:#404040}.ui-dark .ui-configuration-item-summary{color:#777}.ui-dark .ui-configuration-item-note{color:#666}.ui-dark .ui-configuration-type-string input{background-color:transparent;border-color:#404040}.ui-dark .ui-configuration-type-string input:disabled, .ui-dark .ui-configuration-type-number input:disabled{background-color:#303030;color:#666}.ui-dark .ui-configuration-type-multiline textarea{background-color:transparent;border-color:#404040}.ui-dark .ui-configuration-type-multiline textarea:disabled{background-color:#303030;color:#666}.ui-dark .ui-configuration-type-number input{background-color:transparent}.ui-dark .ui-configuration-type-number{border-color:#404040}.ui-dark .ui-configuration-type-number>span{border-left-color:#404040}.ui-dark .ui-configuration-disabled .ui-configuration-type-number{background-color:#303030;color:#666}.ui-dark .ui-configuration-type-boolean div{border-color:#404040}.ui-dark .ui-configuration-type-boolean span{border-color:#404040;background-color:#303030}.ui-dark .ui-configuration-disabled .ui-configuration-type-boolean div{background-color:#303030}.ui-dark .ui-configuration-required .ui-configuration-item-label:before{color:red}.ui-dark .ui-configuration-checked .ui-configuration-type-boolean div{background-color:var(--color);border-color:var(--color)}.ui-dark .ui-configuration-checked span{background-color:#FFF}.ui-dark .ui-configuration-checked i{color:var(--color)}.ui-dark .ui-configuration-type-color{border-color:#404040}.ui-dark .ui-configuration-type-icon{border-color:#404040}.ui-dark .ui-configuration-disabled .ui-configuration-type-icon{color:#666}.ui-dark .ui-configuration-type-date label{color:#666}.ui-dark .ui-configuration-type-date div{border-color:#404040}.ui-dark .ui-configuration-type-date span{border-left-color:#404040}.ui-dark .ui-configuration-disabled .ui-configuration-type-date{color:#666}.ui-dark .ui-configuration-disabled .ui-configuration-type-date div{background-color:#303030}.ui-dark .ui-configuration-type-dropdown label{color:#666}.ui-dark .ui-configuration-type-dropdown div{border-color:#404040}.ui-dark .ui-configuration-type-dropdown span{border-left-color:#404040}.ui-dark .ui-configuration-disabled .ui-configuration-type-dropdown{color:#666}.ui-dark .ui-configuration-disabled .ui-configuration-type-dropdown div{background-color:#303030}.ui-dark .ui-configuration-type-selectable-item{border-color:#404040}.ui-dark .ui-configuration-type-selectable-item:hover{background-color:#383838}.ui-dark .ui-configuration-selected.ui-configuration-type-selectable-item{background-color:var(--color);border-color:var(--color);color:#FFF}</style>
<script>COMPONENT('configuration@1','dateformat:yyyy-MM-dd',function(self,config,cls){var cls2='.'+cls,datasource,items=EMPTYARRAY;self.validate=function(value){if(config.disabled)return true;if(!value)value=EMPTYOBJECT;var errors=[];for(var i=0;i<items.length;i++){var item=items[i];if(item.required&&item.isdisabled!==true&&item.isvisible!==false){var val=value[item.name],is=item.validate(item.prepare(val));item.element.tclass(cls+'-invalid',!is);if(!is)errors.push(item)}}return!errors.length};self.reload=function(){var model=self.get();var prev;for(var i=0;i<items.length;i++){var item=items[i];item.$disable&&item.disable(item.$disable(model||EMPTYOBJECT));var is=true;if(item.$visible){is=item.$visible(model||EMPTYOBJECT);item.element.tclass('hidden',!is)}if(item.element[0].getAttribute('class').indexOf(cls+'-last')!==-1)item.element.rclass(cls+'-last');if(prev&&prev.group!==item.group)prev.element.aclass(cls+'-last');if(is)prev=item}if(prev)prev.element.aclass(cls+'-last')};self.types={};self.types.template=function(item){var icon='';if(item.icon)icon='<i class="'+self.faicon(item.icon)+'"></i>';var builder=[],align=item.align||0;if(align==='center')align=1;else if(align==='right')align=2;builder.push('<div class="{0}-item{1}">'.format(cls,align?(' '+cls+'-align-'+align):''));builder.push('<div class="{0}-item-label">{1}{2}</div>'.format(cls,icon,item.text));item.summary&&builder.push('<div class="{0}-item-summary">{1}</div>'.format(cls,item.summary));builder.push('<div class="{0}-item-control"></div>'.format(cls));item.note&&builder.push('<div class="{0}-item-note">{1}</div>'.format(cls,item.note));item.button&&builder.push('<div class="{0}-button"><button>{1}</button></div>'.format(cls,item.button));item.html&&builder.push(item.html);builder.push('</div>');var T,get=function(){var model=self.get()||EMPTYOBJECT;return model[item.name]};var set=function(val){var model=self.get();var empty=false;if(!model){empty=true;model={}}var old=model[item.name];val=T.prepare(val);if(old!=val){model[item.name]=val;if(empty)SET(self.path,model);else UPD(self.path+'.'+item.name,2);self.change(true);return true}};var el=$(builder.join(''));item.required&&el.aclass(cls+'-required');var control=el.find(cls2+'-item-control');var type=self.types[item.type](item,control,set,get);T=type;type.element=el;type.control=control;type.name=item.name;type.required=item.required;var fndisable=item.disable?FN(item.disable):null;if(fndisable){type.$disable=function(model){var is=!!fndisable(model);item.button&&type.element.find(cls2+'-button button').prop('disabled',is);type.isdisabled=is;return is}}else{type.$disable=null;type.isdisabled=false}var fnvisible=item.visible?FN(item.visible):null;if(fnvisible){type.$visible=function(model){var is=!!fnvisible(model);type.isvisible=is;return is}}else{type.$visible=null;type.isvisible=true}item.noborder&&el.aclass(cls+'-noborder');item.click&&el.find(cls2+'-button button').on('click',function(){var meta={};meta.item=item;meta.value=get();meta.set=set;meta.type=type;self.EXEC(item.click,meta)});return type};self.types.string=function(item,el,set,get){var obj={};obj.bind=function(val){var input=el.find('input');if(item.camouflage){var arr=[];for(var i=0;i<val.length;i++)arr.push('•');val=arr.join('')}input.val(val)};obj.validate=function(val){if(val==null)return false;if(item.transform==='email')return val.isEmail();if(item.transform==='phone')return val.isPhone();if(item.transform==='url')return val.isURL();return!!val};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('input').prop('disabled',!!val)};obj.prepare=function(val){if(val==null)return'';val=(val+'').trim();switch(item.transform){case'phone':case'url':return val.replace(/\s/g,'');case'email':case'lowercase':return val.toLowerCase();case'uppercase':return val.toUppercase();case'slug':return val.slug();case'id':return val.slug().replace(/-/g,'')}return val};el.append('<div class="{0}-type-string"{1}><input type="text" placeholder="{2}" /></div>'.format(cls,item.width?' style="max-width:{0}px"'.format(item.width):'',(item.placeholder||'').encode()));var input=el.find('input');item.maxlength&&input.prop('maxlength',item.maxlength);input.on('change',function(){set(this.value)}).blur(function(){if(item.camouflage)obj.bind(this.value)}).on('focus',function(){if(item.camouflage){var val=obj.prepare(get());this.value=val}});item.monospace&&input.aclass(cls+'-monospace');item.bold&&input.aclass('b');return obj};self.types.multiline=self.types.textarea=function(item,el,set){var obj={};obj.bind=function(val){el.find('input').val(val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('textarea').prop('disabled',!!val)};obj.prepare=function(val){return val!=null?(val+'').trim():''};el.append('<div class="{0}-type-multiline"{2}><textarea placeholder="{1}"></textarea></div>'.format(cls,(item.placeholder||'').encode(),item.height?' style="height:{0}"'.format(item.height):''));var input=el.find('textarea').on('change',function(){set(this.value)});item.monospace&&input.aclass(cls+'-monospace');item.bold&&input.aclass('b');return obj};self.types.group=function(item){var icon='';if(item.icon)icon='<i class="'+self.faicon(item.icon)+'"></i>';var builder=['<div>'];builder.push('<div class="{0}-group">{1}</div>'.format(cls,icon+item.text));if(item.summary)builder.push('<div class="{0}-group-summary">{1}</div>'.format(cls,item.summary));else builder.push('<br>');return builder.join('')+'</div>'};self.types.number=function(item,el,set,get){var obj={};obj.bind=function(val){el.find('input').val(val)};obj.disable=function(val){el.tclass(cls+'-disabled',!!val).find('input').prop('disabled',!!val)};obj.validate=function(val){return val!=0};obj.prepare=function(val){if(val==null)return 0;if(item.min!=null&&val<item.min)val=item.min;else if(item.max!=null&&val>item.max)val=item.max;var type=typeof(val);return type==='string'?val.parseFloat():type==='number'?val:0};el.parent().aclass(cls+'-border');el.append('<div class="{0}-type-number"{1}><span><i class="fa fa-angle-up"></i><i class="fa fa-angle-down"></i></span><div><input type="text" placeholder="{2}" /></div></div>'.format(cls,item.width?' style="max-width:{0}px"'.format(item.width):'',(item.placeholder||'').encode()));var input=el.find('input');input.prop('maxlength',item.maxlength||12);input.on('change blur',function(){set(this.value)});item.monospace&&input.aclass(cls+'-monospace');item.bold&&item.aclass('b');el.find('span i').on('click',function(){if(input[0].disabled)return;var inc=item.increment||1,val=get()||0;if(this.getAttribute('class').indexOf('-up')!==-1){set(val+inc)}else{set(val-inc)}});return obj};self.types.boolean=self.types.checkbox=function(item,el,set){var tcls=cls+'-checked',obj={};obj.bind=function(val){el.tclass(tcls,!!val)};obj.validate=function(val){return val===true};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return!!val};el.parent().aclass(cls+'-border');el.append('<div class="{0}-type-boolean"><div><span><i class="fa fa-check"></i></span></div></div>'.format(cls));el.find(cls2+'-type-boolean > div').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){el.tclass(tcls);set(el.hclass(tcls))}});return obj};self.types.dropdown=function(item,el,set){var obj={};obj.bind=function(val){var items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));var obj=(items||EMPTYARRAY).findItem('id',val);el.find('label').tclass('hidden',!!obj);el.find(cls2+'-value').text(obj?obj.name:'')};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?null:val};el.append('<div class="{0}-type-dropdown"><span><i class="fa fa-angle-down"></i></span><label>{1}</label><div class="{0}-value"></div></div>'.format(cls,(item.placeholder||'').encode()));el.find(cls2+'-type-dropdown').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));var opt={};opt.element=$(this);opt.items=items;opt.placeholder=item.dirplaceholder;opt.search=item.dirsearch;opt.empty=item.dirempty;opt.callback=function(val){set(val?val.id:null)};SETTER('directory/show',opt)}});return obj};self.types.color=function(item,el,set){var obj={};obj.bind=function(val){el.find(cls2+'-type-color div').css('background-color',val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':(val+'')};el.append('<div class="{0}-type-color"><div></div></div>'.format(cls));el.find(cls2+'-type-color').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.element=$(this);opt.callback=set;SETTER('colorpicker/show',opt)}});return obj};self.types.icon=function(item,el,set){var obj={};obj.bind=function(val){el.find(cls2+'-type-icon').html('<i class="{0}"></i>'.format(val))};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':(val+'')};el.append('<div class="{0}-type-icon"></div>'.format(cls));el.find(cls2+'-type-icon').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.element=$(this);opt.callback=set;SETTER('faicons/show',opt)}});return obj};self.types.date=function(item,el,set,get){var obj={};obj.bind=function(val){el.find(cls2+'-value').html(val?val.format(item.format||DEF.dateformat||config.dateformat):'');el.find('label').tclass('hidden',!!val)};obj.validate=function(val){return!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){if(val==null)return null;var type=typeof(val);return type==='string'?val.parseDate():type==='number'?new Date(val):val instanceof Date?val:null};el.append('<div class="{0}-type-date"><span><i class="fa fa-calendar"></i></span><label>{1}</label><div class="{0}-value"></div></div>'.format(cls,(item.placeholder||'').encode()));el.find(cls2+'-type-date').on('click',function(){if(!el.parent().hclass(cls+'-disabled')){var opt={};opt.value=get();opt.element=$(this);opt.callback=set;SETTER('datepicker/show',opt)}});return obj};self.types.selectable=function(item,el,set){var obj={},prev,items=item.items;if(typeof(items)==='string')items=GET(self.makepath(items));if(!(items instanceof Array))items=(items||EMPTYARRAY);obj.bind=function(val){var elements=el.find(cls2+'-type-selectable-item');el.find(cls2+'-selected').rclass(cls+'-selected');if(val instanceof Array){for(var i=0;i<val.length;i++){var index=items.findIndex('id',val[i]);if(index!==-1)elements.eq(index).aclass(cls+'-selected')}}else{var index=items.findIndex('id',val);if(index!==-1)elements.eq(index).aclass(cls+'-selected')}};obj.validate=function(val){return item.multiple?val&&val.length>0:!!val};obj.disable=function(val){el.parent().tclass(cls+'-disabled',!!val)};obj.prepare=function(val){return val==null?'':item.multiple&&val instanceof Array?val:(val+'')};var builder=[];for(var i=0;i<items.length;i++)builder.push('<div class="{0}-type-selectable-item"><i class="{icon}"></i><span>{name}</div>'.format(cls).arg(items[i]));el.append('<div class="{0}-type-selectable">{1}</div>'.format(cls,builder.join('')));el.find(cls2+'-type-selectable-item').on('click',function(){var selcls=cls+'-selected';if(!el.parent().hclass(cls+'-disabled')){var target=$(this);if(item.multiple){target.tclass(selcls)}else{if(prev&&prev[0]!==target[0])prev.rclass(selcls);prev=target.tclass(selcls)}var arr=el.find(cls2+'-selected');var selected=[];for(var i=0;i<arr.length;i++){var index=$(arr[i]).index();selected.push(items[index].id)}set(item.multiple?selected:(selected[0]||null))}});return obj};self.configure=function(key,value){if(key==='datasource'){self.datasource(value,function(path,value){datasource=value;self.redraw();self.refresh()},true)}};self.rebind=function(val){datasource=new Function('val','return '+val.trim())(val);self.redraw();self.refresh()};self.redraw=function(){items=[];self.empty();var container=self.element,was=false,group,count=0;for(var i=0;i<datasource.length;i++){var item=datasource[i];if(item.type==='group'){if(count&&!was)self.append('<br>');group=item;self.append(self.types.group(item));var div=document.createElement('DIV');self.append(div);container=$(div).aclass(cls+'-items')}else{count++;item=self.types.template(item);item.group=group;container.append(item.element);items.push(item)}}};self.make=function(){self.aclass(cls);var template=self.find('script').html();template&&self.rebind(template)};self.setter=function(value,path){if(!value)value={};var diff=path.substring(self.path.length+1);for(var key in value){var val=value[key];for(var j=0;j<items.length;j++){var item=items[j];if(item.name===key&&item.type!=='group'&&(!diff||diff.indexOf(path)===-1))item.bind(item.prepare(val))}}self.reload();self.rclass('invisible')}});</script>