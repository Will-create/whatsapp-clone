<style>.ui-parameters{font-size:11px;border:1px solid #E0E0E0}.ui-parameters-search{height:30px;background-color:#FFF;font-size:12px;border-bottom:1px solid #E0E0E0}.ui-parameters-search span{float:left;width:30px;line-height:30px;text-align:center}.ui-parameters-search .fa-times{color:red;cursor:pointer}.ui-parameters-search div{margin-left:30px}.ui-parameters-search input{width:100%;border:0;outline:0;background:transparent;font-size:12px;height:30px}.ui-parameters-modified{font-weight:bold}.ui-parameters-modified input::placeholder{font-weight:normal}.ui-parameters-item{height:24px;font-size:11px;border-bottom:1px solid #E0E0E0}.ui-parameters-name{margin-right:340px;line-height:23px;padding:0 5px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-parameters-type{float:right;width:120px;line-height:23px;padding:0 5px;text-overflow:ellipsis;overflow:hidden;text-overflow:ellipsis;border-left:1px solid #E0E0E0;border-right:1px solid #E0E0E0;color:gray;background-color:#F9F9F9}.ui-parameters-value{float:right;width:220px;padding:0 0 0 5px;user-select:none;-webkit-user-select:none;-moz-user-select:none}.ui-parameters-value div{display:block;line-height:23px}.ui-parameters-value input{border:0;background:transparent;width:100%;outline:0;height:23px;font-size:11px;line-height:23px;padding:0;margin:0}.ui-parameters-unit div{margin-right:30px}.ui-parameters-unit span{color:gray;width:30px;float:right;line-height:23px;text-align:center}.ui-parameters-boolean{cursor:pointer}.ui-parameters-invalid{background-color:#FFE1E1}.ui-parameters-hidetype .ui-parameters-type{display:none}.ui-parameters-hidetype .ui-parameters-name{margin-right:120px}.ui-parameters-hidetype .ui-parameters-value{border-left:1px solid #E0E0E0}.ui-dark .ui-parameters-invalid{background-color:#653d3d}.ui-dark .ui-parameters-search span{color:gray}.ui-dark .ui-parameters-search{background-color:#252525;border-bottom-color:#404040}.ui-dark .ui-parameters{border-color:#404040}.ui-dark .ui-parameters-modified{color:#FFF}.ui-dark .ui-parameters-item{border-bottom-color:#404040}.ui-dark .ui-parameters-type{background-color:#282828;border-left-color:#404040;border-right-color:#404040}.ui-dark .ui-parameters-hidetype .ui-parameters-value{border-left:1px solid #404040}</style>
<script>COMPONENT('parameters@1','search:Search;dateformat:yyyy-MM-dd;offset:5;margin:0',function(self,config,cls){var cls2='.'+cls,container,search,scroller,skip;self.readonly();self.nocompile();self.bindvisible();self.init=function(){Thelpers.ui_parameters_value=function(val,format){if(val instanceof Date)return val.format(format);if(typeof(val)==='number')return val;return val?Thelpers.encode(val.toString()):''};Thelpers.ui_parameters_label=function(){return this.label||this.name}};self.template=Tangular.compile('<div class="{0}-item{{ if modified}} {0}-modified{{ fi}}" data-index="{{ $.index}}" data-search="{{ $.search}}"><div class="{0}-value{{ if unit}} {0}-unit{{ fi}}{{ if invalid}} {0}-invalid{{ fi}}">{{ if unit}}<span>{{ unit}}</span>{{ fi}}{{ if type === \'boolean\' }}<div class="{0}-boolean">{{ if value}}true{{ else}}false{{ fi}}</div>{{ else}}<div><input class="{0}-input" data-type="{{ type}}" value="{{ value | ui_parameters_value(\'{1}\') }}" placeholder="{{ placeholder}}"/></div>{{ fi}}</div><div class="{0}-type">{{ type}}</div><div class="{0}-name" title="{{ name | ui_parameters_label}}">{{ name | ui_parameters_label}}</div></div>'.format(cls,config.dateformat));self.search=function(){var val=search.find('input').val().toSearch();search.find('i').rclass('fa-').tclass('fa-search',!val).tclass('fa-times',!!val);self.find(cls2+'-item').each(function(){var el=$(this);el.tclass('hidden',val?el.attrd('search').indexOf(val)===-1:false)});self.scrollbar.resize()};self.resize=function(){var h=0;if(config.height>0)h=config.height;else if(config.parent)h=(config.parent==='window'?WH:config.parent==='parent'?self.parent().height():self.closest(config.parent).height())-search.height()-config.offset;h-=config.margin;scroller.css('height',h);self.scrollbar&&self.scrollbar.resize()};self.resize2=function(){setTimeout2(self.ID,self.resize,500)};self.make=function(){self.aclass(cls+(config.hidetype?(' '+cls+'-hidetype'):''));self.append('<div class="{0}-search"><span><i class="fa fa-search"></i></span><div><input type="text" placeholder="{1}" maxlength="50" class="{0}-searchinput" /></div></div><div class="{0}-scroller"><div class="{0}-container"></div></div>'.format(cls,config.search));container=self.find(cls2+'-container');search=self.find(cls2+'-search');scroller=self.find(cls2+'-scroller');self.resize();self.scrollbar=SCROLLBAR(scroller);search.on('keydown',cls2+'-searchinput',function(){setTimeout2(self.ID,self.search,300)});container.on('keydown',cls2+'-input',function(e){if(e.which!==38&&e.which!==40)return;var t=this,type=t.getAttribute('data-type');if(type!=='number'&&type!=='date')return;var row=$(t).closest(cls2+'-item');var index=+row.attrd('index');var item=self.get()[index];var val=t.value;if(item.type==='number'){val=val.replace(',','.');val=+val}else if(item.type==='date')val=val.parseDate(config.dateformat);switch(e.which){case 38:if(item.type==='date')val=val.add('1 day').format(config.dateformat);else val+=1;e.preventDefault();break;case 40:if(item.type==='date')val=val.add('-1 day').format(config.dateformat);else val-=1;e.preventDefault();break}this.value=val+''});search.on('click','.fa-times',function(){search.find('input').val('');self.search()});container.on('dblclick',cls2+'-boolean',function(){var el=$(this).parent();var row=el.closest(cls2+'-item');var index=+row.attrd('index');var item=self.get()[index];var indexer={index:index,search:item.name.toSearch()};skip=true;item.value=!item.value;item.modified=item.prev!==item.value;row.replaceWith(self.template(item,indexer));item.modified&&self.change(true);UPD(self.path,2)});var skipblur=false;container.on('change blur',cls2+'-input',function(e){if(skipblur)return;if(e.type==='change'){setTimeout(function(){skipblur=false},300);skipblur=true}var el=$(this);var row=el.closest(cls2+'-item');var index=+row.attrd('index');var item=self.get()[index];var indexer={index:index,search:item.name.toSearch()};item.value=el.val();switch(item.type){case'date':item.value=item.value?item.value.parseDate(config.dateformat):null;if(item.value&&isNaN(item.value.getTime())){item.invalid=true;item.value=item.prev}else item.invalid=false;if(!item.invalid)item.invalid=(item.min?item.min>item.value:false)||(item.max?item.max<item.value:false);var a=item.value?item.value.format(config.dateformat):0;var b=item.prev?item.prev.format(config.dateformat):0;item.modified=a!==b;break;case'number':var val=item.value.parseFloat();item.invalid=(item.min!=null&&val<item.min)||(item.max!=null&&val>item.max);if(!item.invalid)item.value=val;item.modified=item.value!==item.prev;break;default:item.modified=item.value!==(item.prev==null?'':item.prev);break}row.replaceWith(self.template(item,indexer));item.modified&&self.change(true);skip=true;UPD(self.path,2)});self.on('resize + resize2',self.resize2);self.resize();self.scrollbar.resize()};self.setter=function(value){if(!value)return;if(skip){skip=false;return}var builder=[],indexer={};for(var i=0;i<value.length;i++){var item=value[i];indexer.index=i;indexer.search=item.name.toSearch();item.prev=item.type==='date'&&item.value?item.value.format(config.dateformat):item.value;builder.push(self.template(item,indexer))}container.html(builder.join(''));self.search();self.resize()}});</script>